import{x as n}from"./index-wSJOnhhK.js";import{a as l}from"./index-t--hEgTQ.js";const i=n("user",{state:()=>({userInfo:JSON.parse(localStorage.getItem("userInfo")||"{}")}),getters:{isLoggedIn:r=>!!r.userInfo.id,username:r=>r.userInfo.username||""},actions:{async login(r){try{console.log("开始登录请求:",r.username);const o=await l.post("/api/admin/login",r);console.log("登录响应:",o.data);const{data:s}=o.data,{user:e,token:t}=s;if(this.userInfo=e,localStorage.setItem("userInfo",JSON.stringify(e)),t)localStorage.setItem("token",t);else{const a=`${e.id}:${Date.now()}`;localStorage.setItem("token",a)}return{success:!0}}catch(o){console.error("Login failed:",o);let s="登录失败，请检查您的用户名和密码";if(o.response){const{data:e,status:t}=o.response;console.log("错误状态码:",t),console.log("错误响应数据:",e),e.msg?s=e.msg:e.message?s=e.message:e.error&&(s=e.error),console.error(`登录错误 (${t}): ${s}`)}else o.request?(s="服务器无响应，请检查网络连接",console.error("请求已发送但无响应:",o.request)):(s="请求配置错误: "+o.message,console.error("请求配置错误:",o.message));return{success:!1,message:s}}},logout(){this.userInfo={},localStorage.removeItem("userInfo"),localStorage.removeItem("token")}}});export{i as u};
