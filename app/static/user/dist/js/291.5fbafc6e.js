"use strict";(self["webpackChunkecodeco_user_client"]=self["webpackChunkecodeco_user_client"]||[]).push([[291],{47291:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});a(52675),a(89463),a(44114),a(62010),a(9868);var u=a(56768),r=a(95187),o=function(e){return(0,u.Qi)("data-v-2bab2a6a"),e=e(),(0,u.jt)(),e},c={class:"product-detail"},n={key:0,class:"container"},l={class:"product-content"},i={class:"product-image"},d={class:"product-badges"},s={key:0,class:"eco-badge"},p={key:1,class:"recyclable-badge"},v={key:2,class:"custom-badge"},b={class:"product-info"},f={class:"product-name"},k={class:"product-meta"},g={class:"product-price"},m={class:"product-actions"},_=o((function(){return(0,u.Lk)("i",{class:"el-icon-shopping-cart-2"},null,-1)})),h={class:"product-tabs"},y={class:"product-description"},F=o((function(){return(0,u.Lk)("h3",null,"产品描述",-1)})),C=o((function(){return(0,u.Lk)("h3",null,"规格参数",-1)})),L={class:"related-products"},w=o((function(){return(0,u.Lk)("h2",{class:"section-title"},"相关产品推荐",-1)})),W={key:1,class:"loading-container"};function E(e,t,a,o,E,x){var A=(0,u.g2)("el-breadcrumb-item"),X=(0,u.g2)("el-breadcrumb"),P=(0,u.g2)("el-image"),I=(0,u.g2)("el-input-number"),V=(0,u.g2)("el-button"),T=(0,u.g2)("el-table-column"),q=(0,u.g2)("el-table"),K=(0,u.g2)("el-tab-pane"),Q=(0,u.g2)("el-tabs"),U=(0,u.g2)("product-card"),j=(0,u.g2)("el-col"),D=(0,u.g2)("el-row"),R=(0,u.g2)("el-skeleton"),N=(0,u.g2)("el-result");return(0,u.uX)(),(0,u.CE)("div",c,[o.product?((0,u.uX)(),(0,u.CE)("div",n,[(0,u.bF)(X,{separator:"/"},{default:(0,u.k6)((function(){return[(0,u.bF)(A,{to:{path:"/"}},{default:(0,u.k6)((function(){return[(0,u.eW)("首页")]})),_:1}),(0,u.bF)(A,{to:{path:"/products"}},{default:(0,u.k6)((function(){return[(0,u.eW)("全部产品")]})),_:1}),(0,u.bF)(A,{to:{path:"/products?category=".concat(o.product.category)}},{default:(0,u.k6)((function(){return[(0,u.eW)((0,r.v_)(o.product.category),1)]})),_:1},8,["to"]),(0,u.bF)(A,null,{default:(0,u.k6)((function(){return[(0,u.eW)((0,r.v_)(o.product.name),1)]})),_:1})]})),_:1}),(0,u.Lk)("div",l,[(0,u.Lk)("div",i,[(0,u.bF)(P,{src:o.fullImageUrl,alt:o.product.name,fit:"cover"},null,8,["src","alt"]),(0,u.Lk)("div",d,[o.product.eco_certification?((0,u.uX)(),(0,u.CE)("span",s,(0,r.v_)(o.product.eco_certification),1)):(0,u.Q3)("",!0),o.product.is_recyclable?((0,u.uX)(),(0,u.CE)("span",p,"可回收")):(0,u.Q3)("",!0),o.product.is_custom?((0,u.uX)(),(0,u.CE)("span",v,"可定制")):(0,u.Q3)("",!0)])]),(0,u.Lk)("div",b,[(0,u.Lk)("h1",f,(0,r.v_)(o.product.name),1),(0,u.Lk)("div",k,[(0,u.Lk)("div",g,"¥"+(0,r.v_)(o.product.price.toFixed(2)),1),(0,u.Lk)("div",{class:(0,r.C4)(["product-stock",{"out-of-stock":o.product.stock<=0}])},(0,r.v_)(o.product.stock>0?"库存: ".concat(o.product.stock):"库存不足"),3)]),(0,u.Lk)("div",m,[(0,u.bF)(I,{modelValue:o.quantity,"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.quantity=e}),min:1,max:o.product.stock,disabled:o.product.stock<=0},null,8,["modelValue","max","disabled"]),(0,u.bF)(V,{type:"primary",disabled:o.product.stock<=0,onClick:o.addToCart},{default:(0,u.k6)((function(){return[_,(0,u.eW)(" 加入购物车 ")]})),_:1},8,["disabled","onClick"]),(0,u.bF)(V,{type:"success",disabled:o.product.stock<=0,onClick:o.buyNow},{default:(0,u.k6)((function(){return[(0,u.eW)(" 立即购买 ")]})),_:1},8,["disabled","onClick"])])])]),(0,u.Lk)("div",h,[(0,u.bF)(Q,{modelValue:o.activeTab,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.activeTab=e})},{default:(0,u.k6)((function(){return[(0,u.bF)(K,{label:"产品详情",name:"details"},{default:(0,u.k6)((function(){return[(0,u.Lk)("div",y,[F,(0,u.Lk)("p",null,(0,r.v_)(o.product.description),1),C,(0,u.bF)(q,{data:o.specifications,stripe:"",style:{width:"100%"}},{default:(0,u.k6)((function(){return[(0,u.bF)(T,{prop:"name",label:"参数名",width:"180"}),(0,u.bF)(T,{prop:"value",label:"参数值"})]})),_:1},8,["data"])])]})),_:1})]})),_:1},8,["modelValue"])]),(0,u.Lk)("div",L,[w,(0,u.bF)(D,{gutter:20},{default:(0,u.k6)((function(){return[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(o.relatedProducts,(function(e){return(0,u.uX)(),(0,u.Wv)(j,{xs:24,sm:12,md:8,lg:6,key:e.id},{default:(0,u.k6)((function(){return[(0,u.bF)(U,{product:e},null,8,["product"])]})),_:2},1024)})),128))]})),_:1})])])):o.loading?((0,u.uX)(),(0,u.CE)("div",W,[(0,u.bF)(R,{rows:10,animated:""})])):((0,u.uX)(),(0,u.Wv)(N,{key:2,icon:"error",title:"加载失败","sub-title":"请稍后再试或返回首页"},{extra:(0,u.k6)((function(){return[(0,u.bF)(V,{type:"primary",onClick:t[2]||(t[2]=function(t){return e.$router.push("/")})},{default:(0,u.k6)((function(){return[(0,u.eW)("返回首页")]})),_:1})]})),_:1}))])}var x=a(14048),A=a(74721),X=a(30388),P=(a(28706),a(2008),a(74423),a(64346),a(48598),a(34782),a(18111),a(22489),a(26099),a(21699),a(71798)),I=a(50973),V=a(60782),T=a(51219),q=a(69204),K=a(61981),Q=a(41154);const U={name:"ProductDetail",components:{ProductCard:q.A,EcoIcon:Q.A},setup:function(){var e=(0,I.lq)(),t=(0,I.rd)(),r=(0,V.Pj)(),o=(0,u.EW)((function(){return r.getters["products/currentProduct"]})),c=(0,u.EW)((function(){return r.getters["isLoading"]})),n=(0,P.KR)("details"),l=(0,P.KR)(1),i=(0,u.EW)((function(){var e,t,a,u,r,c=[];if(null!==(e=o.value)&&void 0!==e&&e.material&&c.push({name:"蔬菜瓜果类型",value:o.value.material}),void 0!==(null===(t=o.value)||void 0===t?void 0:t.eco_labels)&&null!==(null===(a=o.value)||void 0===a?void 0:a.eco_labels)&&o.value.eco_labels.length>0){var n=Array.isArray(o.value.eco_labels)?o.value.eco_labels.join("，"):o.value.eco_labels;c.push({name:"营养标签",value:n})}return void 0!==(null===(u=o.value)||void 0===u?void 0:u.carbon_footprint)&&null!==(null===(r=o.value)||void 0===r?void 0:r.carbon_footprint)&&c.push({name:"每件总量",value:"".concat(o.value.carbon_footprint," Kg")}),c.push({name:"产地",value:"中国大陆"}),c})),d=(0,P.KR)([]);(0,u.sV)((0,X.A)((0,x.A)().mark((function a(){var u,c,n,l;return(0,x.A)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,u=e.params.id,console.log("产品详情页-路由参数:",e.params),u){a.next=8;break}return console.error("产品ID为空，无法获取产品详情"),T.nk.error("无效的产品ID"),t.push("/products"),a.abrupt("return");case 8:return a.next=10,r.dispatch("products/fetchProduct",u);case 10:if(a.sent,o.value){a.next=16;break}return console.error("产品获取失败，返回产品列表页"),T.nk.error("无法获取产品详情"),t.push("/products"),a.abrupt("return");case 16:console.log("产品详情页-获取到产品:",o.value),c=r.getters["products/allProducts"],o.value&&c&&c.length>0?(n=o.value.product_id||o.value.id,d.value=c.filter((function(e){return e.category===o.value.category&&(e.product_id||e.id)!==n})).slice(0,4),d.value.length<4&&(l=c.filter((function(e){return(e.product_id||e.id)!==n&&!d.value.includes(e)})).slice(0,4-d.value.length),d.value=[].concat((0,A.A)(d.value),(0,A.A)(l)))):console.log("没有找到足够的产品数据来推荐相关产品"),a.next=25;break;case 21:a.prev=21,a.t0=a["catch"](0),console.error("获取产品详情失败:",a.t0),T.nk.error("获取产品详情失败");case 25:case"end":return a.stop()}}),a,null,[[0,21]])}))));var s=function(){o.value.stock<=0?T.nk.warning("该产品已售罄"):(r.dispatch("cart/addToCart",{product:o.value,quantity:l.value}),T.nk.success("成功添加到购物车"))},p=function(){s(),t.push("/cart")},v=(0,u.EW)((function(){return o.value?(console.log("处理产品图片，产品数据:",o.value),o.value.image?o.value.image:o.value.image_url?(0,K.m)(o.value.image_url):o.value.images&&o.value.images.length>0?o.value.images[0]:(console.warn("产品没有图片"),a(67015))):a(67015)}));return{product:o,loading:c,activeTab:n,quantity:l,specifications:i,relatedProducts:d,addToCart:s,buyNow:p,fullImageUrl:v}}};var j=a(71241);const D=(0,j.A)(U,[["render",E],["__scopeId","data-v-2bab2a6a"]]),R=D}}]);
//# sourceMappingURL=291.5fbafc6e.js.map