import{a as S,r as $,y as Y,u as Z,c as z,b as y,d as t,w as r,e as l,E as _,z as ee,o as h,g as d,B as te,p as ae,t as C,j as re,I as oe,v as N}from"./index-gpBZUzsn.js";import{h as k}from"./http-D8_Qy496.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-t--hEgTQ.js";const V={getOrders(u){return k.get("/api/orders",{params:u})},getOrder(u){return k.get(`/api/orders/${u}`)},updateOrderStatus(u,w){return k.put(`/api/orders/${u}/status`,{status:w})},deleteOrder(u){return k.post(`/api/orders/${u}/action`,{action:"delete"})}},le={class:"orders-container"},se={class:"page-header"},de={class:"header-actions"},ie={key:0},ue={key:1},pe={class:"pagination-container"},ce={__name:"Orders",setup(u){const w=Z(),x=S(!1),B=S([]),s=$({page:1,perPage:10,total:0}),n=$({orderNumber:"",status:"",userId:""}),p=async()=>{x.value=!0;try{const a={page:s.page,per_page:s.perPage};n.orderNumber&&(a.order_number=n.orderNumber),n.status&&(a.status=n.status),n.userId&&(a.user_id=n.userId);const e=await V.getOrders(a);B.value=e.items,s.total=e.total}catch(a){console.error("获取订单列表失败:",a),_.error("获取订单列表失败，请稍后重试")}finally{x.value=!1}},T=()=>{p()},M=()=>{s.page=1,p()},D=()=>{n.orderNumber="",n.status="",n.userId="",s.page=1,p()},P=a=>{s.perPage=a,p()},F=a=>{s.page=a,p()},U=a=>({pending:"待付款",paid:"已付款",shipped:"已发货",delivered:"已送达",canceled:"已取消"})[a]||a,E=a=>({pending:"warning",paid:"primary",shipped:"success",delivered:"success",canceled:"danger"})[a]||"info",b=(a,e)=>{var c;const{status:i}=a;return((c={pending:["paid","canceled"],paid:["shipped","canceled"],shipped:["delivered"],delivered:[],canceled:[]}[i])==null?void 0:c.includes(e))||!1},j=a=>{w.push(`/orders/${a.id}`)},A=(a,e)=>{const i={paid:"已付款",shipped:"已发货",delivered:"已送达",canceled:"已取消"};N.confirm(`确定要将订单 ${e.order_number} 标记为${i[a]}吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:a==="canceled"?"warning":"info"}).then(async()=>{try{await V.updateOrderStatus(e.id,a),_.success(`订单状态已更新为${i[a]}`),p()}catch(f){console.error("更新订单状态失败:",f),_.error("更新订单状态失败，请稍后重试")}}).catch(()=>{})},R=a=>{N.confirm(`确定要删除订单 ${a.order_number} 吗？此操作不可恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}).then(async()=>{try{await V.deleteOrder(a.id),_.success("订单删除成功"),p()}catch(e){console.error("删除订单失败:",e),_.error("删除订单失败，请稍后重试")}}).catch(()=>{_.info("已取消删除操作")})};return Y(()=>{const{user_id:a}=w.currentRoute.value.query;a&&(n.userId=a.toString()),p()}),(a,e)=>{const i=l("el-button"),f=l("el-input"),c=l("el-form-item"),g=l("el-option"),q=l("el-select"),G=l("el-form"),I=l("el-card"),m=l("el-table-column"),H=l("el-tag"),J=l("el-icon"),v=l("el-dropdown-item"),K=l("el-dropdown-menu"),L=l("el-dropdown"),Q=l("el-table"),W=l("el-pagination"),X=ee("loading");return h(),z("div",le,[y("div",se,[e[6]||(e[6]=y("h1",{class:"page-title"},"订单管理",-1)),y("div",de,[t(i,{type:"primary",onClick:T},{default:r(()=>e[5]||(e[5]=[d("刷新数据")])),_:1})])]),t(I,{class:"filter-container",shadow:"never"},{default:r(()=>[t(G,{inline:!0,model:n,class:"filter-form"},{default:r(()=>[t(c,{label:"订单号"},{default:r(()=>[t(f,{modelValue:n.orderNumber,"onUpdate:modelValue":e[0]||(e[0]=o=>n.orderNumber=o),placeholder:"输入订单号搜索"},null,8,["modelValue"])]),_:1}),t(c,{label:"订单状态"},{default:r(()=>[t(q,{modelValue:n.status,"onUpdate:modelValue":e[1]||(e[1]=o=>n.status=o),placeholder:"所有状态",clearable:""},{default:r(()=>[t(g,{label:"待付款",value:"pending"}),t(g,{label:"已付款",value:"paid"}),t(g,{label:"已发货",value:"shipped"}),t(g,{label:"已送达",value:"delivered"}),t(g,{label:"已取消",value:"canceled"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"用户ID"},{default:r(()=>[t(f,{modelValue:n.userId,"onUpdate:modelValue":e[2]||(e[2]=o=>n.userId=o),placeholder:"输入用户ID搜索"},null,8,["modelValue"])]),_:1}),t(c,null,{default:r(()=>[t(i,{type:"primary",onClick:M},{default:r(()=>e[7]||(e[7]=[d("搜索")])),_:1}),t(i,{onClick:D},{default:r(()=>e[8]||(e[8]=[d("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(I,{class:"table-container",shadow:"never"},{default:r(()=>[te((h(),ae(Q,{data:B.value,style:{width:"100%"},border:""},{default:r(()=>[t(m,{type:"index",width:"50"}),t(m,{prop:"order_number",label:"订单号","min-width":"180"}),t(m,{prop:"user_id",label:"用户",width:"120"},{default:r(o=>[o.row.user?(h(),z("span",ie,C(o.row.user.username),1)):(h(),z("span",ue,"用户 #"+C(o.row.user_id),1))]),_:1}),t(m,{prop:"total_amount",label:"订单金额",width:"120"},{default:r(o=>[d(" ¥ "+C(o.row.total_amount.toFixed(2)),1)]),_:1}),t(m,{prop:"created_at",label:"下单时间","min-width":"180"}),t(m,{prop:"status",label:"订单状态",width:"120"},{default:r(o=>[t(H,{type:E(o.row.status),size:"small",effect:"light",class:"status-tag"},{default:r(()=>[d(C(U(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"操作",width:"260"},{default:r(o=>[t(i,{size:"small",type:"success",onClick:O=>j(o.row),link:""},{default:r(()=>e[9]||(e[9]=[d("查看")])),_:2},1032,["onClick"]),t(L,{trigger:"click",size:"small",onCommand:O=>A(O,o.row)},{dropdown:r(()=>[t(K,null,{default:r(()=>[t(v,{command:"paid",disabled:!b(o.row,"paid")},{default:r(()=>e[11]||(e[11]=[d(" 标记为已付款 ")])),_:2},1032,["disabled"]),t(v,{command:"shipped",disabled:!b(o.row,"shipped")},{default:r(()=>e[12]||(e[12]=[d(" 标记为已发货 ")])),_:2},1032,["disabled"]),t(v,{command:"delivered",disabled:!b(o.row,"delivered")},{default:r(()=>e[13]||(e[13]=[d(" 标记为已送达 ")])),_:2},1032,["disabled"]),t(v,{command:"canceled",disabled:!b(o.row,"canceled"),divided:""},{default:r(()=>e[14]||(e[14]=[d(" 取消订单 ")])),_:2},1032,["disabled"])]),_:2},1024)]),default:r(()=>[t(i,{size:"small",link:"",type:"primary"},{default:r(()=>[e[10]||(e[10]=d(" 更改状态 ")),t(J,{class:"el-icon--right"},{default:r(()=>[t(re(oe))]),_:1})]),_:1})]),_:2},1032,["onCommand"]),t(i,{size:"small",type:"danger",onClick:O=>R(o.row),link:""},{default:r(()=>e[15]||(e[15]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,x.value]]),y("div",pe,[t(W,{"current-page":s.page,"onUpdate:currentPage":e[3]||(e[3]=o=>s.page=o),"page-size":s.perPage,"onUpdate:pageSize":e[4]||(e[4]=o=>s.perPage=o),total:s.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1})])}}},we=ne(ce,[["__scopeId","data-v-002f7e01"]]);export{we as default};
