import{a as B,h as q,i as G,y as j,c as x,b as d,B as A,d as t,w as s,e as c,z as H,p as M,E as g,u as J,o as m,g as l,G as K,t as n,v as L}from"./index-onYwJO-V.js";import{a as T}from"./index-t--hEgTQ.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"order-detail-container"},U={class:"page-header"},W={class:"header-actions"},X={class:"card-header"},Y={class:"order-number"},Z={key:0,class:"order-info"},ee={class:"info-section"},te={key:0,class:"info-section"},se={class:"info-section"},ae={class:"order-total"},le={class:"total-amount"},oe={class:"info-section"},de={__name:"OrderDetail",setup(ne){const z=G(),F=J(),_=B(!1),a=B({}),w=q(()=>z.params.id),h=async()=>{if(!w.value){g.error("订单ID不能为空");return}_.value=!0;try{const o=await T.get(`/api/orders/${w.value}`);a.value=o.data}catch(o){console.error("获取订单详情失败:",o),g.error("获取订单详情失败，请稍后重试")}finally{_.value=!1}},I=()=>{h()},O=()=>{F.push("/orders")},k=o=>({pending:"待付款",paid:"已付款",shipped:"已发货",delivered:"已送达",canceled:"已取消"})[o]||o,$=o=>({pending:"warning",paid:"primary",shipped:"success",delivered:"success",canceled:"danger"})[o]||"info",b=o=>{var v;const e=a.value.status;return e&&((v={pending:["paid","canceled"],paid:["shipped","canceled"],shipped:["delivered"],delivered:[],canceled:[]}[e])==null?void 0:v.includes(o))||!1},y=o=>{const e={paid:"已付款",shipped:"已发货",delivered:"已送达",canceled:"已取消"};L.confirm(`确定要将订单 ${a.value.order_number} 标记为${e[o]}吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:o==="canceled"?"warning":"info"}).then(async()=>{try{_.value=!0,await T.put(`/api/orders/${w.value}/status`,{status:o}),g.success(`订单状态已更新为${e[o]}`),h()}catch(i){console.error("更新订单状态失败:",i),g.error("更新订单状态失败，请稍后重试")}finally{_.value=!1}}).catch(()=>{})};return j(()=>{h()}),(o,e)=>{const i=c("el-button"),v=c("el-tag"),u=c("el-descriptions-item"),D=c("el-descriptions"),p=c("el-table-column"),E=c("el-table"),N=c("el-button-group"),S=c("el-empty"),V=c("el-card"),R=H("loading");return m(),x("div",Q,[d("div",U,[e[6]||(e[6]=d("h1",{class:"page-title"},"订单详情",-1)),d("div",W,[t(i,{onClick:O},{default:s(()=>e[4]||(e[4]=[l("返回")])),_:1}),t(i,{type:"primary",onClick:I},{default:s(()=>e[5]||(e[5]=[l("刷新")])),_:1})])]),A((m(),M(V,{shadow:"never",class:"detail-card"},{header:s(()=>[d("div",X,[d("span",Y,"订单号："+n(a.value.order_number),1),t(v,{type:$(a.value.status),class:"status-tag",size:"small"},{default:s(()=>[l(n(k(a.value.status)),1)]),_:1},8,["type"])])]),default:s(()=>{var C;return[a.value.id?(m(),x("div",Z,[d("div",ee,[e[7]||(e[7]=d("h3",{class:"section-title"},"基本信息",-1)),t(D,{column:2,border:"",size:"small"},{default:s(()=>[t(u,{label:"订单ID"},{default:s(()=>[l(n(a.value.id),1)]),_:1}),t(u,{label:"用户ID"},{default:s(()=>[l(n(a.value.user_id),1)]),_:1}),t(u,{label:"订单状态"},{default:s(()=>[t(v,{type:$(a.value.status),size:"small"},{default:s(()=>[l(n(k(a.value.status)),1)]),_:1},8,["type"])]),_:1}),t(u,{label:"订单金额"},{default:s(()=>{var r;return[l("¥ "+n((r=a.value.total_amount)==null?void 0:r.toFixed(2)),1)]}),_:1}),t(u,{label:"创建时间"},{default:s(()=>[l(n(a.value.created_at),1)]),_:1}),t(u,{label:"更新时间"},{default:s(()=>[l(n(a.value.updated_at),1)]),_:1})]),_:1})]),a.value.address?(m(),x("div",te,[e[8]||(e[8]=d("h3",{class:"section-title"},"收货信息",-1)),t(D,{column:1,border:"",size:"small"},{default:s(()=>[t(u,{label:"收货人"},{default:s(()=>[l(n(a.value.address.name),1)]),_:1}),t(u,{label:"联系电话"},{default:s(()=>[l(n(a.value.address.phone),1)]),_:1}),t(u,{label:"收货地址"},{default:s(()=>[l(n(`${a.value.address.province} ${a.value.address.city} ${a.value.address.district} ${a.value.address.detail}`),1)]),_:1})]),_:1})])):K("",!0),d("div",se,[e[10]||(e[10]=d("h3",{class:"section-title"},"订单商品",-1)),t(E,{data:a.value.items||[],border:"",style:{width:"100%"},size:"small"},{default:s(()=>[t(p,{type:"index",width:"50"}),t(p,{prop:"product_id",label:"商品ID",width:"80"}),t(p,{prop:"product_name",label:"商品名称","min-width":"200"}),t(p,{prop:"price",label:"单价",width:"100"},{default:s(r=>{var f;return[l(" ¥ "+n((f=r.row.price)==null?void 0:f.toFixed(2)),1)]}),_:1}),t(p,{prop:"quantity",label:"数量",width:"100"}),t(p,{prop:"subtotal",label:"小计",width:"120"},{default:s(r=>{var f;return[l(" ¥ "+n((f=r.row.subtotal)==null?void 0:f.toFixed(2)),1)]}),_:1})]),_:1},8,["data"]),d("div",ae,[e[9]||(e[9]=d("span",null,"订单总计：",-1)),d("span",le,"¥ "+n((C=a.value.total_amount)==null?void 0:C.toFixed(2)),1)])]),d("div",oe,[e[15]||(e[15]=d("h3",{class:"section-title"},"订单操作",-1)),t(N,{class:"action-buttons"},{default:s(()=>[t(i,{type:"primary",onClick:e[0]||(e[0]=r=>y("paid")),disabled:!b("paid")},{default:s(()=>e[11]||(e[11]=[l("标记为已付款")])),_:1},8,["disabled"]),t(i,{type:"success",onClick:e[1]||(e[1]=r=>y("shipped")),disabled:!b("shipped")},{default:s(()=>e[12]||(e[12]=[l("标记为已发货")])),_:1},8,["disabled"]),t(i,{type:"info",onClick:e[2]||(e[2]=r=>y("delivered")),disabled:!b("delivered")},{default:s(()=>e[13]||(e[13]=[l("标记为已送达")])),_:1},8,["disabled"]),t(i,{type:"danger",onClick:e[3]||(e[3]=r=>y("canceled")),disabled:!b("canceled")},{default:s(()=>e[14]||(e[14]=[l("取消订单")])),_:1},8,["disabled"])]),_:1})])])):(m(),M(S,{key:1,description:"未找到订单信息"}))]}),_:1})),[[R,_.value]])])}}},ce=P(de,[["__scopeId","data-v-3e4c5201"]]);export{ce as default};
