"use strict";(self["webpackChunkecodeco_user_client"]=self["webpackChunkecodeco_user_client"]||[]).push([[889],{59889:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ee});n(62010),n(9868);var r=n(56768),o=n(5688),a=n(95187),l=function(e){return(0,r.Qi)("data-v-4622b658"),e=e(),(0,r.jt)(),e},c={class:"product-list-page"},u={class:"container"},i={class:"page-header"},s=l((function(){return(0,r.Lk)("h1",null,"新鲜农产品",-1)})),d={class:"header-right"},g={class:"filter-section"},f={class:"filter-row"},p=l((function(){return(0,r.Lk)("div",{class:"filter-label"},"分类：",-1)})),v={class:"filter-options"},k={class:"filter-row"},y=l((function(){return(0,r.Lk)("div",{class:"filter-label"},"营养特性：",-1)})),h={class:"filter-options"},_={class:"filter-actions"},b={class:"sort-section"},F={class:"view-mode"},C={key:0,class:"products-loading"},m={class:"skeleton-item"},w={style:{padding:"14px"}},L={style:{"margin-top":"16px",display:"flex","justify-content":"space-between"}},W={key:1,class:"products-error"},P={key:2,class:"no-products"},x=["onClick"],E={class:"product-image"},V=l((function(){return(0,r.Lk)("div",{class:"image-error-slot"},[(0,r.Lk)("i",{class:"el-icon-picture-outline"}),(0,r.Lk)("p",null,"图片加载失败")],-1)})),K={key:0,class:"discount-badge"},X={class:"product-body"},q={class:"product-name"},R={class:"eco-badges"},z={class:"product-price"},Q={class:"current-price"},S={key:0,class:"original-price"},A={class:"product-actions"},I={key:4,class:"pagination-container"};function M(e,t,n,l,M,D){var U=(0,r.g2)("el-input"),j=(0,r.g2)("el-radio-button"),B=(0,r.g2)("el-radio-group"),T=(0,r.g2)("el-checkbox"),O=(0,r.g2)("el-checkbox-group"),$=(0,r.g2)("el-button"),J=(0,r.g2)("el-card"),N=(0,r.g2)("el-button-group"),G=(0,r.g2)("el-skeleton-item"),H=(0,r.g2)("el-skeleton"),Y=(0,r.g2)("el-empty"),Z=(0,r.g2)("el-image"),ee=(0,r.g2)("el-tag"),te=(0,r.g2)("el-pagination");return(0,r.uX)(),(0,r.CE)("div",c,[(0,r.Lk)("div",u,[(0,r.Lk)("div",i,[s,(0,r.Lk)("div",d,[(0,r.bF)(U,{modelValue:l.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=function(e){return l.searchQuery=e}),placeholder:"搜索产品","prefix-icon":"el-icon-search",clearable:"",onClear:l.handleSearchClear,onKeyup:(0,o.jR)(l.handleSearch,["enter"]),class:"search-input"},null,8,["modelValue","onClear","onKeyup"])])]),(0,r.Lk)("div",g,[(0,r.bF)(J,null,{default:(0,r.k6)((function(){return[(0,r.Lk)("div",f,[p,(0,r.Lk)("div",v,[(0,r.bF)(B,{modelValue:l.filters.category,"onUpdate:modelValue":t[1]||(t[1]=function(e){return l.filters.category=e}),onChange:l.applyFilters},{default:(0,r.k6)((function(){return[(0,r.bF)(j,{label:""},{default:(0,r.k6)((function(){return[(0,r.eW)("全部")]})),_:1}),(0,r.bF)(j,{label:"蔬菜"},{default:(0,r.k6)((function(){return[(0,r.eW)("蔬菜")]})),_:1}),(0,r.bF)(j,{label:"水果"},{default:(0,r.k6)((function(){return[(0,r.eW)("水果")]})),_:1})]})),_:1},8,["modelValue","onChange"])])]),(0,r.Lk)("div",k,[y,(0,r.Lk)("div",h,[(0,r.bF)(O,{modelValue:l.filters.ecoFeatures,"onUpdate:modelValue":t[2]||(t[2]=function(e){return l.filters.ecoFeatures=e}),onChange:l.applyFilters},{default:(0,r.k6)((function(){return[(0,r.bF)(T,{label:"recyclable"},{default:(0,r.k6)((function(){return[(0,r.eW)("低脂肪")]})),_:1}),(0,r.bF)(T,{label:"organic"},{default:(0,r.k6)((function(){return[(0,r.eW)("低糖")]})),_:1}),(0,r.bF)(T,{label:"energy_efficient"},{default:(0,r.k6)((function(){return[(0,r.eW)("高蛋白")]})),_:1}),(0,r.bF)(T,{label:"low_voc"},{default:(0,r.k6)((function(){return[(0,r.eW)("低热量")]})),_:1}),(0,r.bF)(T,{label:"sustainable_wood"},{default:(0,r.k6)((function(){return[(0,r.eW)("高膳食纤维")]})),_:1})]})),_:1},8,["modelValue","onChange"])])]),(0,r.Lk)("div",_,[(0,r.bF)($,{type:"primary",onClick:l.applyFilters},{default:(0,r.k6)((function(){return[(0,r.eW)("应用筛选")]})),_:1},8,["onClick"]),(0,r.bF)($,{onClick:l.resetFilters},{default:(0,r.k6)((function(){return[(0,r.eW)("重置")]})),_:1},8,["onClick"])])]})),_:1})]),(0,r.Lk)("div",b,[(0,r.bF)(B,{modelValue:l.sortBy,"onUpdate:modelValue":t[3]||(t[3]=function(e){return l.sortBy=e}),size:"small",onChange:l.handleSortChange},{default:(0,r.k6)((function(){return[(0,r.bF)(j,{label:"popularity"},{default:(0,r.k6)((function(){return[(0,r.eW)("热门")]})),_:1}),(0,r.bF)(j,{label:"newest"},{default:(0,r.k6)((function(){return[(0,r.eW)("最新")]})),_:1}),(0,r.bF)(j,{label:"price_asc"},{default:(0,r.k6)((function(){return[(0,r.eW)("价格从低到高")]})),_:1}),(0,r.bF)(j,{label:"price_desc"},{default:(0,r.k6)((function(){return[(0,r.eW)("价格从高到低")]})),_:1})]})),_:1},8,["modelValue","onChange"]),(0,r.Lk)("div",F,[(0,r.bF)(N,null,{default:(0,r.k6)((function(){return[(0,r.bF)($,{type:"grid"===l.viewMode?"primary":"",icon:"el-icon-s-grid",onClick:t[4]||(t[4]=function(e){return l.viewMode="grid"})},null,8,["type"]),(0,r.bF)($,{type:"list"===l.viewMode?"primary":"",icon:"el-icon-menu",onClick:t[5]||(t[5]=function(e){return l.viewMode="list"})},null,8,["type"])]})),_:1})])]),l.loading?((0,r.uX)(),(0,r.CE)("div",C,[(0,r.Lk)("div",{class:(0,a.C4)(["skeleton-container",{"list-view":"list"===l.viewMode}])},[(0,r.bF)(H,{count:8,animated:""},{template:(0,r.k6)((function(){return[(0,r.Lk)("div",m,[(0,r.bF)(G,{variant:"image",style:{width:"100%",height:"200px"}}),(0,r.Lk)("div",w,[(0,r.bF)(G,{variant:"h3",style:{width:"70%"}}),(0,r.Lk)("div",L,[(0,r.bF)(G,{variant:"text",style:{width:"30%"}}),(0,r.bF)(G,{variant:"text",style:{width:"30%"}})])])])]})),_:1})],2)])):l.error?((0,r.uX)(),(0,r.CE)("div",W,[(0,r.bF)(Y,{description:"加载产品失败"},{default:(0,r.k6)((function(){return[(0,r.bF)($,{type:"primary",onClick:l.fetchProducts},{default:(0,r.k6)((function(){return[(0,r.eW)("重试")]})),_:1},8,["onClick"])]})),_:1})])):0===l.filteredProducts.length?((0,r.uX)(),(0,r.CE)("div",P,[(0,r.bF)(Y,{description:"没有找到匹配的产品"},{default:(0,r.k6)((function(){return[(0,r.bF)($,{onClick:l.resetFilters},{default:(0,r.k6)((function(){return[(0,r.eW)("重置筛选条件")]})),_:1},8,["onClick"])]})),_:1})])):((0,r.uX)(),(0,r.CE)("div",{key:3,class:(0,a.C4)(["products-container",{"list-view":"list"===l.viewMode}])},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.filteredProducts,(function(t){return(0,r.uX)(),(0,r.CE)("div",{key:t.id,class:"product-card",onClick:function(e){return l.viewProductDetail(t)}},[(0,r.Lk)("div",E,[(0,r.bF)(Z,{src:l.getFullImageUrl(t.image_url||t.image||t.product_image||""),alt:t.name,onError:function(){return e.console.warn("产品图片加载失败:",t.product_id||t.id)}},{error:(0,r.k6)((function(){return[V]})),_:2},1032,["src","alt","onError"]),t.discount?((0,r.uX)(),(0,r.CE)("div",K," -"+(0,a.v_)(t.discount)+"% ",1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",X,[(0,r.Lk)("h3",q,(0,a.v_)(t.name),1),(0,r.Lk)("div",R,[t.eco_certification?((0,r.uX)(),(0,r.Wv)(ee,{key:0,size:"small",type:"success"},{default:(0,r.k6)((function(){return[(0,r.eW)((0,a.v_)(t.eco_certification),1)]})),_:2},1024)):(0,r.Q3)("",!0),t.is_recyclable?((0,r.uX)(),(0,r.Wv)(ee,{key:1,size:"small",type:"info"},{default:(0,r.k6)((function(){return[(0,r.eW)(" 可回收 ")]})),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",z,[(0,r.Lk)("span",Q,"¥"+(0,a.v_)(t.price.toFixed(2)),1),t.original_price?((0,r.uX)(),(0,r.CE)("span",S," ¥"+(0,a.v_)(t.original_price.toFixed(2)),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",A,[(0,r.bF)($,{type:"primary",size:"small",icon:"el-icon-shopping-cart-2",onClick:(0,o.D$)((function(e){return l.addToCart(t)}),["stop"])},{default:(0,r.k6)((function(){return[(0,r.eW)(" 加入购物车 ")]})),_:2},1032,["onClick"]),(0,r.bF)($,{size:"small",icon:"el-icon-view",onClick:(0,o.D$)((function(e){return l.viewProductDetail(t)}),["stop"])},{default:(0,r.k6)((function(){return[(0,r.eW)(" 查看详情 ")]})),_:2},1032,["onClick"])])])],8,x)})),128))],2)),l.totalPages>1?((0,r.uX)(),(0,r.CE)("div",I,[(0,r.bF)(te,{background:"","current-page":l.currentPage,"page-size":l.pageSize,total:l.totalProducts,layout:"prev, pager, next",onCurrentChange:l.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])):(0,r.Q3)("",!0)])])}var D=n(14048),U=n(30388),j=n(74721),B=(n(52675),n(89463),n(28706),n(2008),n(74423),n(62062),n(44114),n(15086),n(26910),n(60739),n(23288),n(18111),n(22489),n(61701),n(13579),n(33110),n(26099),n(58940),n(27495),n(21699),n(25440),n(5746),n(71798)),T=n(50973),O=n(60782),$=n(51219),J=n(61981),N=n(50788),G=n.n(N);const H={name:"ProductList",setup:function(){var e=(0,T.rd)(),t=(0,T.lq)(),n=(0,O.Pj)(),o=(0,B.KR)([]),a=(0,B.KR)(!1),l=(0,B.KR)(!1),c=(0,B.KR)(1),u=(0,B.KR)(20),i=(0,B.KR)(0),s=(0,B.KR)(""),d=(0,B.KR)("grid"),g=(0,B.KR)("popularity"),f=(0,B.Kh)({category:"",ecoFeatures:[]}),p=(0,r.EW)((function(){return Math.ceil(i.value/u.value)})),v=(0,r.EW)((function(){console.log("开始筛选产品，原始数量:",o.value.length),o.value.length>0&&console.log("产品数据示例:",o.value[0]);var e=(0,j.A)(o.value);if(s.value){var t=s.value.toLowerCase();e=e.filter((function(e){return e.name&&e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)})),console.log("搜索筛选后数量:",e.length)}return f.category&&(console.log("应用分类筛选:",f.category),console.log("产品中的分类字段:",o.value.map((function(e){return"".concat(e.product_id,": ").concat(e.category||e.category_id)}))),e=e.filter((function(e){var t=e.category||e.category_id,n=t===f.category;return console.log("产品 ".concat(e.product_id," 分类 ").concat(t," 是否匹配 ").concat(f.category,": ").concat(n)),n})),console.log("分类筛选后数量:",e.length)),f.ecoFeatures.length>0&&(console.log("应用生态特性筛选:",f.ecoFeatures),e=e.filter((function(e){var t=f.ecoFeatures.some((function(t){return"recyclable"===t?e.is_recyclable:"organic"===t?"有机认证"===e.eco_certification:"energy_efficient"===t?"能源之星认证"===e.eco_certification:"low_voc"===t?"低VOC认证"===e.eco_certification:"sustainable_wood"===t&&"森林管理委员会认证"===e.eco_certification}));return t})),console.log("环保特性筛选后数量:",e.length)),"newest"===g.value?e.sort((function(e,t){return new Date(t.created_at||0)-new Date(e.created_at||0)})):"price_asc"===g.value?e.sort((function(e,t){return(e.price||0)-(t.price||0)})):"price_desc"===g.value?e.sort((function(e,t){return(t.price||0)-(e.price||0)})):"popularity"===g.value&&e.sort((function(e,t){return(t.sold_count||0)-(e.sold_count||0)})),console.log("最终显示产品数量:",e.length),e})),k=function(){console.log("初始化筛选条件，URL参数:",t.query),f.category="",f.ecoFeatures=[],s.value="",c.value=1,t.query.category&&(f.category=t.query.category),t.query.search&&(s.value=t.query.search),t.query.page&&(c.value=parseInt(t.query.page)||1),console.log("初始化后的筛选条件:",{category:f.category,ecoFeatures:f.ecoFeatures,searchQuery:s.value,page:c.value})},y=function(){var t={};f.category&&(t.category=f.category),s.value&&(t.search=s.value),c.value>1&&(t.page=c.value),e.replace({query:t})},h=function(){var e=(0,U.A)((0,D.A)().mark((function e(){var t,n,r,d;return(0,D.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=!0,l.value=!1,e.prev=2,t={page:c.value,size:u.value||20},console.log("获取产品列表，参数:",t),f.category&&(t.category_id=f.category,console.log("添加分类过滤:",f.category)),s.value&&(t.keyword=s.value,console.log("添加搜索关键词:",s.value)),g.value&&(t.sort=g.value,console.log("添加排序条件:",g.value)),console.log("完整请求参数:",t),e.next=11,G().get("/api/products/list",{params:t});case 11:n=e.sent,console.log("API响应状态:",n.status),console.log("API响应数据:",n.data),n.data&&200===n.data.code&&n.data.data&&n.data.data.list?(r=n.data.data.list,d=n.data.data.total||0,console.log("产品列表获取成功: ".concat(r.length,"个产品，总数:").concat(d)),r.length>0&&console.log("产品示例:",JSON.stringify(r[0])),o.value=r,i.value=d):(console.warn("API返回格式不符合预期:",n.data),o.value=[],i.value=0),e.next=23;break;case 17:e.prev=17,e.t0=e["catch"](2),console.error("获取产品列表失败:",e.t0),e.t0.response&&(console.error("错误状态码:",e.t0.response.status),console.error("错误数据:",e.t0.response.data)),l.value=!0,o.value=[];case 23:return e.prev=23,a.value=!1,e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[2,17,23,26]])})));return function(){return e.apply(this,arguments)}}(),_=function(e){c.value=e,h(),y(),window.scrollTo(0,0)},b=function(){console.log("应用筛选条件:",{category:f.category,ecoFeatures:f.ecoFeatures}),c.value=1,y(),h()},F=function(){console.log("重置所有筛选条件"),f.category="",f.ecoFeatures=[],c.value=1,s.value="",y(),h()},C=function(){console.log("执行搜索:",s.value),c.value=1,y(),h()},m=function(){console.log("清除搜索"),s.value="",C()},w=function(){},L=function(t){var n=t.product_id||t.id;e.push("/product/".concat(n))},W=function(e){n.dispatch("cart/addToCart",{product:e,quantity:1}),$.nk.success("已添加到购物车")};return(0,r.wB)((function(){return t.query}),(function(e){k()})),(0,r.sV)((function(){k(),h()})),{products:o,filteredProducts:v,loading:a,error:l,currentPage:c,pageSize:u,totalProducts:i,totalPages:p,searchQuery:s,viewMode:d,sortBy:g,filters:f,fetchProducts:h,handlePageChange:_,applyFilters:b,resetFilters:F,handleSearch:C,handleSearchClear:m,handleSortChange:w,viewProductDetail:L,addToCart:W,getFullImageUrl:J.m}}};var Y=n(71241);const Z=(0,Y.A)(H,[["render",M],["__scopeId","data-v-4622b658"]]),ee=Z}}]);
//# sourceMappingURL=889.c554c2d3.js.map