"use strict";(self["webpackChunkecodeco_user_client"]=self["webpackChunkecodeco_user_client"]||[]).push([[953],{92776:(e,t,n)=>{n.d(t,{FR:()=>u,Re:()=>a,ab:()=>l,yU:()=>i});var r=n(35720);function a(){return(0,r.A)({url:"/api/user/addresses",method:"get"})}function u(e){return(0,r.A)({url:"/api/user/addresses",method:"post",data:e})}function i(e,t){return(0,r.A)({url:"/api/user/addresses/".concat(e),method:"put",data:t})}function l(e){return(0,r.A)({url:"/api/user/addresses/".concat(e),method:"delete"})}console.log("request 对象：",r.A)},96953:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Fe});n(44114),n(62010),n(9868);var r=n(56768),a=n(95187),u=function(e){return(0,r.Qi)("data-v-b46597ae"),e=e(),(0,r.jt)(),e},i={class:"checkout-page"},l={class:"container"},c=u((function(){return(0,r.Lk)("div",{class:"page-header"},[(0,r.Lk)("h1",null,"订单结算")],-1)})),s={key:0},d=u((function(){return(0,r.Lk)("h3",{class:"section-title"},"确认商品信息",-1)})),o={class:"product-info"},f={class:"product-details"},p={key:0,class:"product-tags"},k={class:"price"},v={class:"subtotal"},m=u((function(){return(0,r.Lk)("h3",{class:"section-title"},"收货地址",-1)})),g={key:0},_={key:0,class:"default-tag"},b={key:1},h=u((function(){return(0,r.Lk)("br",null,null,-1)})),L={key:0,class:"default-tag"},y={class:"step-actions"},F={key:1},w=u((function(){return(0,r.Lk)("h3",{class:"section-title"},"订单信息",-1)})),C={class:"summary-item"},A=u((function(){return(0,r.Lk)("span",null,"商品总价：",-1)})),S={class:"price"},W={class:"summary-item"},x=u((function(){return(0,r.Lk)("span",null,"运费：",-1)})),I={class:"summary-item"},V=u((function(){return(0,r.Lk)("span",null,"优惠金额：",-1)})),E={class:"summary-item total"},R=u((function(){return(0,r.Lk)("span",null,"应付总额：",-1)})),X={class:"price"},K=u((function(){return(0,r.Lk)("h3",{class:"section-title"},"选择支付方式",-1)})),D={class:"payment-option"},M=u((function(){return(0,r.Lk)("div",{class:"payment-icon alipay-icon"},null,-1)})),T={class:"payment-option"},Q=u((function(){return(0,r.Lk)("div",{class:"payment-icon wechat-icon"},null,-1)})),U={class:"payment-option"},q=u((function(){return(0,r.Lk)("div",{class:"payment-icon card-icon"},[(0,r.Lk)("i",{class:"el-icon-bank-card"})],-1)})),j={class:"step-actions"},z={key:2},N={class:"order-success"},B={class:"order-detail-card"},$=u((function(){return(0,r.Lk)("h3",null,"订单信息",-1)})),O={class:"order-detail-item"},Y=u((function(){return(0,r.Lk)("span",{class:"detail-label"},"订单号：",-1)})),H={class:"detail-value"},P={class:"order-detail-item"},G=u((function(){return(0,r.Lk)("span",{class:"detail-label"},"下单时间：",-1)})),J={class:"detail-value"},Z={class:"order-detail-item"},ee=u((function(){return(0,r.Lk)("span",{class:"detail-label"},"订单金额：",-1)})),te={class:"detail-value price"},ne={class:"order-detail-item"},re=u((function(){return(0,r.Lk)("span",{class:"detail-label"},"支付方式：",-1)})),ae={class:"detail-value"},ue={class:"success-actions"},ie=u((function(){return(0,r.Lk)("div",{class:"order-tips"},[(0,r.Lk)("h4",null,"温馨提示："),(0,r.Lk)("p",null,"1. 您的订单已提交成功，请您立即支付，我们将尽快为您安排发货。"),(0,r.Lk)("p",null,"2. 如需修改订单信息，请尽快联系客服。"),(0,r.Lk)("p",null,"3. 欢迎在收到商品后对商品进行评价，您的意见对我们非常重要。")],-1)}));function le(e,t,n,u,le,ce){var se=(0,r.g2)("el-step"),de=(0,r.g2)("el-steps"),oe=(0,r.g2)("el-image"),fe=(0,r.g2)("el-tag"),pe=(0,r.g2)("el-table-column"),ke=(0,r.g2)("el-table"),ve=(0,r.g2)("el-card"),me=(0,r.g2)("el-radio"),ge=(0,r.g2)("el-radio-group"),_e=(0,r.g2)("el-button"),be=(0,r.g2)("el-dialog"),he=(0,r.g2)("el-result");return(0,r.uX)(),(0,r.CE)("div",i,[(0,r.Lk)("div",l,[c,(0,r.bF)(de,{active:u.currentStep,"finish-status":"success",class:"checkout-steps"},{default:(0,r.k6)((function(){return[(0,r.bF)(se,{title:"确认订单"}),(0,r.bF)(se,{title:"选择支付方式"}),(0,r.bF)(se,{title:"完成下单"})]})),_:1},8,["active"]),0===u.currentStep?((0,r.uX)(),(0,r.CE)("div",s,[d,(0,r.bF)(ke,{data:u.cartItems,style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:(0,r.k6)((function(){return[(0,r.bF)(pe,{label:"商品信息","min-width":"400"},{default:(0,r.k6)((function(e){var t=e.row;return[(0,r.Lk)("div",o,[(0,r.bF)(oe,{src:u.getFullImageUrl(t.image_url),alt:t.name,class:"product-image"},null,8,["src","alt"]),(0,r.Lk)("div",f,[(0,r.Lk)("h4",null,(0,a.v_)(t.name),1),t.eco_certification||t.is_recyclable?((0,r.uX)(),(0,r.CE)("div",p,[t.eco_certification?((0,r.uX)(),(0,r.Wv)(fe,{key:0,size:"small",type:"success"},{default:(0,r.k6)((function(){return[(0,r.eW)((0,a.v_)(t.eco_certification),1)]})),_:2},1024)):(0,r.Q3)("",!0),t.is_recyclable?((0,r.uX)(),(0,r.Wv)(fe,{key:1,size:"small",type:"info"},{default:(0,r.k6)((function(){return[(0,r.eW)("可回收")]})),_:1})):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])])]})),_:1}),(0,r.bF)(pe,{label:"单价",align:"center",width:"120"},{default:(0,r.k6)((function(e){var t=e.row;return[(0,r.Lk)("span",k,"¥"+(0,a.v_)(t.price.toFixed(2)),1)]})),_:1}),(0,r.bF)(pe,{label:"数量",align:"center",width:"100"},{default:(0,r.k6)((function(e){var t=e.row;return[(0,r.Lk)("span",null,"x "+(0,a.v_)(t.quantity),1)]})),_:1}),(0,r.bF)(pe,{label:"小计",align:"center",width:"120"},{default:(0,r.k6)((function(e){var t=e.row;return[(0,r.Lk)("span",v,"¥"+(0,a.v_)((t.price*t.quantity).toFixed(2)),1)]})),_:1})]})),_:1},8,["data"]),m,(0,r.bF)(ve,{class:"selected-address-card",onClick:t[0]||(t[0]=function(e){return u.addressDialogVisible=!0})},{default:(0,r.k6)((function(){return[u.selectedAddress?((0,r.uX)(),(0,r.CE)("div",g,[(0,r.Lk)("div",null,(0,a.v_)(u.selectedAddress.name)+" "+(0,a.v_)(u.selectedAddress.phone),1),(0,r.Lk)("div",null,(0,a.v_)(u.selectedAddress.province)+" "+(0,a.v_)(u.selectedAddress.city)+" "+(0,a.v_)(u.selectedAddress.district)+" "+(0,a.v_)(u.selectedAddress.detail),1),u.selectedAddress.is_default?((0,r.uX)(),(0,r.CE)("div",_,"默认地址")):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",b,"请选择地址"))]})),_:1}),(0,r.bF)(be,{modelValue:u.addressDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=function(e){return u.addressDialogVisible=e}),title:"选择收货地址",width:"600px"},{footer:(0,r.k6)((function(){return[(0,r.bF)(_e,{onClick:t[2]||(t[2]=function(e){return u.addressDialogVisible=!1})},{default:(0,r.k6)((function(){return[(0,r.eW)("取消")]})),_:1}),(0,r.bF)(_e,{type:"primary",onClick:u.confirmSelectAddress},{default:(0,r.k6)((function(){return[(0,r.eW)("确定")]})),_:1},8,["onClick"])]})),default:(0,r.k6)((function(){return[(0,r.bF)(ge,{modelValue:u.selectedAddressId,"onUpdate:modelValue":t[1]||(t[1]=function(e){return u.selectedAddressId=e}),class:"address-radio-group"},{default:(0,r.k6)((function(){return[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.addressList,(function(e,t){return(0,r.uX)(),(0,r.Wv)(ve,{key:e.id,class:(0,a.C4)(["address-item",{selected:e.id===u.selectedAddressId}])},{default:(0,r.k6)((function(){return[(0,r.bF)(me,{label:e.id},{default:(0,r.k6)((function(){return[(0,r.eW)((0,a.v_)(e.name)+" "+(0,a.v_)(e.phone),1),h,(0,r.eW)(" "+(0,a.v_)(e.province)+" "+(0,a.v_)(e.city)+" "+(0,a.v_)(e.district)+" "+(0,a.v_)(e.detail)+" ",1),e.is_default?((0,r.uX)(),(0,r.CE)("span",L,"默认")):(0,r.Q3)("",!0)]})),_:2},1032,["label"])]})),_:2},1032,["class"])})),128))]})),_:1},8,["modelValue"])]})),_:1},8,["modelValue"]),(0,r.Lk)("div",y,[(0,r.bF)(_e,{onClick:t[4]||(t[4]=function(t){return e.$router.push("/cart")})},{default:(0,r.k6)((function(){return[(0,r.eW)("返回购物车")]})),_:1}),(0,r.bF)(_e,{type:"primary",onClick:t[5]||(t[5]=function(e){return u.currentStep=u.checkCartStatus()?1:0})},{default:(0,r.k6)((function(){return[(0,r.eW)("下一步")]})),_:1})])])):(0,r.Q3)("",!0),1===u.currentStep?((0,r.uX)(),(0,r.CE)("div",F,[w,(0,r.bF)(ve,{class:"order-summary"},{default:(0,r.k6)((function(){return[(0,r.Lk)("div",C,[A,(0,r.Lk)("span",S,"¥"+(0,a.v_)(u.cartTotal.toFixed(2)),1)]),(0,r.Lk)("div",W,[x,(0,r.Lk)("span",null,"¥"+(0,a.v_)(u.shipping.toFixed(2)),1)]),(0,r.Lk)("div",I,[V,(0,r.Lk)("span",null,"-¥"+(0,a.v_)(u.discount.toFixed(2)),1)]),(0,r.Lk)("div",E,[R,(0,r.Lk)("span",X,"¥"+(0,a.v_)(u.orderTotal.toFixed(2)),1)])]})),_:1}),K,(0,r.bF)(ve,{class:"payment-card"},{default:(0,r.k6)((function(){return[(0,r.bF)(ge,{modelValue:u.paymentMethod,"onUpdate:modelValue":t[6]||(t[6]=function(e){return u.paymentMethod=e})},{default:(0,r.k6)((function(){return[(0,r.Lk)("div",D,[(0,r.bF)(me,{label:"alipay"},{default:(0,r.k6)((function(){return[(0,r.eW)("支付宝")]})),_:1}),M]),(0,r.Lk)("div",T,[(0,r.bF)(me,{label:"wechat"},{default:(0,r.k6)((function(){return[(0,r.eW)("微信支付")]})),_:1}),Q]),(0,r.Lk)("div",U,[(0,r.bF)(me,{label:"creditcard"},{default:(0,r.k6)((function(){return[(0,r.eW)("银行卡支付")]})),_:1}),q])]})),_:1},8,["modelValue"])]})),_:1}),(0,r.Lk)("div",j,[(0,r.bF)(_e,{onClick:t[7]||(t[7]=function(e){return u.currentStep=0})},{default:(0,r.k6)((function(){return[(0,r.eW)("上一步")]})),_:1}),(0,r.bF)(_e,{type:"primary",onClick:u.submitOrder},{default:(0,r.k6)((function(){return[(0,r.eW)("提交订单")]})),_:1},8,["onClick"])])])):(0,r.Q3)("",!0),2===u.currentStep?((0,r.uX)(),(0,r.CE)("div",z,[(0,r.Lk)("div",N,[(0,r.bF)(he,{icon:"success",title:"订单提交成功!","sub-title":"您的订单已提交成功，我们将尽快为您处理"}),(0,r.Lk)("div",B,[$,(0,r.Lk)("div",O,[Y,(0,r.Lk)("span",H,(0,a.v_)(u.orderNumber),1)]),(0,r.Lk)("div",P,[G,(0,r.Lk)("span",J,(0,a.v_)(u.orderTime),1)]),(0,r.Lk)("div",Z,[ee,(0,r.Lk)("span",te,"¥"+(0,a.v_)(u.finalAmount.toFixed(2)),1)]),(0,r.Lk)("div",ne,[re,(0,r.Lk)("span",ae,(0,a.v_)("alipay"===u.paymentMethod?"支付宝":"wechat"===u.paymentMethod?"微信支付":"银行卡支付"),1)])]),(0,r.Lk)("div",ue,[(0,r.bF)(_e,{type:"primary",onClick:t[8]||(t[8]=function(t){return e.$router.push("/orders")})},{default:(0,r.k6)((function(){return[(0,r.eW)("查看订单")]})),_:1}),(0,r.bF)(_e,{onClick:t[9]||(t[9]=function(t){return e.$router.push("/")})},{default:(0,r.k6)((function(){return[(0,r.eW)("返回首页")]})),_:1})]),ie])])):(0,r.Q3)("",!0)])])}var ce=n(41034),se=n(14048),de=n(30388),oe=(n(16280),n(76918),n(28706),n(2008),n(50113),n(48598),n(62062),n(59089),n(23288),n(18111),n(22489),n(20116),n(61701),n(32637),n(26099),n(58940),n(38781),n(68156),n(71798)),fe=n(60782),pe=n(50973),ke=n(51219),ve=n(91036),me=n(61981),ge=n(92776),_e=n(50788),be=n.n(_e);const he={name:"Checkout",setup:function(){var e=(0,fe.Pj)(),t=(0,pe.rd)(),n=(0,oe.KR)(0),a=(0,r.EW)((function(){return e.getters["cart/cartItems"]})),u=(0,r.EW)((function(){return e.getters["cart/cartTotal"]})),i=(0,r.EW)((function(){return e.getters["cart/cartCount"]})),l=(0,oe.KR)(10),c=(0,oe.KR)(0),s=(0,r.EW)((function(){return u.value+l.value-c.value})),d=(0,oe.KR)("alipay"),o=(0,oe.KR)(""),f=(0,oe.KR)(""),p=(0,oe.KR)(0),k=(0,oe.KR)([]),v=(0,oe.KR)(null),m=(0,oe.KR)(null),g=(0,oe.KR)(!1),_=function(){var e=(0,de.A)((0,se.A)().mark((function e(){var t;return(0,se.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,ge.Re)();case 3:t=e.sent,k.value=t,t.length>0&&(v.value=t.find((function(e){return e.is_default}))||t[0]),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),ke.nk.error("加载地址失败");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),b=function(){if(0===a.value.length)return ke.nk.warning("您的购物车为空，请先添加商品"),t.push("/products"),!1;var e=a.value.filter((function(e){return e.stock<=0}));if(e.length>0){var n=e.map((function(e){return e.name})).join("、");return ke.nk.warning("商品「".concat(n,"」缺货，请从购物车中移除后再结算")),t.push("/cart"),!1}return!0},h=function(){var e=k.value.find((function(e){return e.id===m.value}));e?(v.value=e,g.value=!1):ke.nk.warning("请选择地址")};(0,r.sV)((function(){b(),_()}));var L=function(){var e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),a=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return"".concat(t).concat(n).concat(r).concat(a)},y=function(){try{var e=new Date,t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),a=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(r," ").concat(a,":").concat(u)}catch(i){return(new Date).toLocaleString("zh-CN")}},F=function(){if(d.value)if(0!==a.value.length){var t=a.value.map((function(e){var t=(0,ce.A)({},e);return t.id||t.product_id||(t._id?t.id=t._id:t.productId?t.id=t.productId:t.id="temp_".concat(Date.now(),"_").concat(t.name)),t.id=parseInt(t.id),t})).filter((function(e){return Number.isInteger(e.id)&&e.id>0}));0!==t.length?s.value<=0?ke.nk.warning("订单金额异常，请刷新页面重试"):ve.s.confirm("确认提交订单 ¥".concat(s.value.toFixed(2)," ?"),"确认订单",{confirmButtonText:"确认提交",cancelButtonText:"取消",type:"warning"}).then((0,de.A)((0,se.A)().mark((function r(){var a,u,i,l,c,d;return(0,se.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,u=localStorage.getItem("token"),u&&"null"!==u&&"undefined"!==u){r.next=5;break}return ke.nk.error("用户未登录，请先登录"),r.abrupt("return");case 5:return i="Bearer ".concat(u),l={address_id:(null===(a=v.value)||void 0===a?void 0:a.id)||0,items:t.map((function(e){return{product_id:e.id,quantity:parseInt(e.quantity)}}))},r.next=9,be().post("/api/orders/create",l,{headers:{Authorization:i,"Content-Type":"application/json"}});case 9:if(c=r.sent,!c||!c.data||200!==c.data.code){r.next=19;break}p.value=s.value,o.value=c.data.data.order_number||L(),f.value=y(),e.dispatch("cart/clearCart"),n.value=2,ke.nk.success("订单提交成功"),r.next=20;break;case 19:throw new Error((null===c||void 0===c||null===(d=c.data)||void 0===d?void 0:d.msg)||"订单提交失败");case 20:r.next=26;break;case 22:r.prev=22,r.t0=r["catch"](0),console.error("提交订单失败:",r.t0),ke.nk.error(r.t0.message||"订单提交失败，请重试");case 26:case"end":return r.stop()}}),r,null,[[0,22]])}))))["catch"]((function(){})):ke.nk.warning("没有有效商品可提交")}else ke.nk.warning("购物车为空，无法提交订单");else ke.nk.warning("请选择支付方式")};return(0,r.sV)((function(){b()})),{currentStep:n,cartItems:a,cartTotal:u,cartCount:i,shipping:l,discount:c,orderTotal:s,paymentMethod:d,submitOrder:F,getFullImageUrl:me.m,orderNumber:o,orderTime:f,finalAmount:p,checkCartStatus:b,selectedAddress:v,selectedAddressId:m,addressDialogVisible:g,addressList:k,confirmSelectAddress:h}}};var Le=n(71241);const ye=(0,Le.A)(he,[["render",le],["__scopeId","data-v-b46597ae"]]),Fe=ye}}]);
//# sourceMappingURL=953.65a897f4.js.map