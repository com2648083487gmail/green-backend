"use strict";(self["webpackChunkecodeco_user_client"]=self["webpackChunkecodeco_user_client"]||[]).push([[403],{63403:(e,r,a)=>{a.r(r),a.d(r,{default:()=>K});var t=a(56768),s=a(95187),o=function(e){return(0,t.Qi)("data-v-68369aa1"),e=e(),(0,t.jt)(),e},n={class:"profile-container"},i={class:"profile-content"},l={class:"row"},u={class:"col-lg-4"},d={class:"profile-card"},c={class:"profile-card-body text-center"},p=["src"],m={class:"my-3"},f={class:"text-muted mb-1"},w=o((function(){return(0,t.Lk)("p",{class:"text-muted mb-4"},"会员等级: 普通会员",-1)})),v={class:"action-buttons"},k={class:"col-lg-8"},g={class:"profile-card"},b={class:"profile-card-body"},h={class:"info-row"},F=o((function(){return(0,t.Lk)("div",{class:"info-label"},[(0,t.Lk)("p",null,"用户名")],-1)})),L={class:"info-value"},P={class:"text-muted"},V=o((function(){return(0,t.Lk)("div",{class:"divider"},null,-1)})),_={class:"info-row"},D=o((function(){return(0,t.Lk)("div",{class:"info-label"},[(0,t.Lk)("p",null,"邮箱")],-1)})),A={class:"info-value"},x={class:"text-muted"},y=o((function(){return(0,t.Lk)("div",{class:"divider"},null,-1)})),C={class:"info-row"},U=o((function(){return(0,t.Lk)("div",{class:"info-label"},[(0,t.Lk)("p",null,"手机号")],-1)})),$={class:"info-value"},E={class:"text-muted"},R=o((function(){return(0,t.Lk)("div",{class:"divider"},null,-1)})),W={class:"info-row"},S=o((function(){return(0,t.Lk)("div",{class:"info-label"},[(0,t.Lk)("p",null,"注册时间")],-1)})),q={class:"info-value"},z={class:"text-muted"},I={class:"avatar-upload"},B=["src"],N={class:"dialog-footer"},T={class:"dialog-footer"};function j(e,r,a,o,j,J){var M=(0,t.g2)("el-button"),O=(0,t.g2)("el-input"),Q=(0,t.g2)("el-form-item"),X=(0,t.g2)("el-upload"),G=(0,t.g2)("el-form"),H=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",n,[(0,t.Lk)("div",i,[(0,t.Lk)("div",l,[(0,t.Lk)("div",u,[(0,t.Lk)("div",d,[(0,t.Lk)("div",c,[(0,t.Lk)("img",{src:J.userAvatar,alt:"用户头像",class:"avatar-img"},null,8,p),(0,t.Lk)("h5",m,(0,s.v_)(e.user?e.user.username:"加载中..."),1),(0,t.Lk)("p",f,(0,s.v_)(e.user?e.user.email:"加载中..."),1),w,(0,t.Lk)("div",v,[(0,t.bF)(M,{type:"primary",onClick:J.showEditDialog},{default:(0,t.k6)((function(){return[(0,t.eW)("编辑资料")]})),_:1},8,["onClick"]),(0,t.bF)(M,{onClick:J.showPasswordDialog},{default:(0,t.k6)((function(){return[(0,t.eW)("修改密码")]})),_:1},8,["onClick"])])])])]),(0,t.Lk)("div",k,[(0,t.Lk)("div",g,[(0,t.Lk)("div",b,[(0,t.Lk)("div",h,[F,(0,t.Lk)("div",L,[(0,t.Lk)("p",P,(0,s.v_)(e.user?e.user.username:"加载中..."),1)])]),V,(0,t.Lk)("div",_,[D,(0,t.Lk)("div",A,[(0,t.Lk)("p",x,(0,s.v_)(e.user?e.user.email:"加载中..."),1)])]),y,(0,t.Lk)("div",C,[U,(0,t.Lk)("div",$,[(0,t.Lk)("p",E,(0,s.v_)(e.user&&e.user.phone?e.user.phone:"未设置"),1)])]),R,(0,t.Lk)("div",W,[S,(0,t.Lk)("div",q,[(0,t.Lk)("p",z,(0,s.v_)(e.user&&e.user.created_at?J.formatDate(e.user.created_at):"未知"),1)])])])])])])]),(0,t.bF)(H,{title:"编辑个人资料",modelValue:j.editDialogVisible,"onUpdate:modelValue":r[3]||(r[3]=function(e){return j.editDialogVisible=e}),width:"500px"},{footer:(0,t.k6)((function(){return[(0,t.Lk)("span",N,[(0,t.bF)(M,{onClick:r[2]||(r[2]=function(e){return j.editDialogVisible=!1})},{default:(0,t.k6)((function(){return[(0,t.eW)("取消")]})),_:1}),(0,t.bF)(M,{type:"primary",onClick:J.updateProfile,loading:j.updating},{default:(0,t.k6)((function(){return[(0,t.eW)(" 保存 ")]})),_:1},8,["onClick","loading"])])]})),default:(0,t.k6)((function(){return[(0,t.bF)(G,{model:j.editForm,"label-width":"80px"},{default:(0,t.k6)((function(){return[(0,t.bF)(Q,{label:"用户名"},{default:(0,t.k6)((function(){return[(0,t.bF)(O,{modelValue:j.editForm.username,"onUpdate:modelValue":r[0]||(r[0]=function(e){return j.editForm.username=e}),placeholder:"请输入用户名"},null,8,["modelValue"])]})),_:1}),(0,t.bF)(Q,{label:"头像"},{default:(0,t.k6)((function(){return[(0,t.Lk)("div",I,[(0,t.Lk)("img",{src:j.editForm.avatarPreview||J.userAvatar,class:"avatar-preview"},null,8,B),(0,t.bF)(X,{class:"avatar-uploader",action:"#","show-file-list":!1,"before-upload":J.beforeAvatarUpload,"http-request":J.handleAvatarUpload},{default:(0,t.k6)((function(){return[(0,t.bF)(M,{type:"primary"},{default:(0,t.k6)((function(){return[(0,t.eW)("选择图片")]})),_:1})]})),_:1},8,["before-upload","http-request"])])]})),_:1}),(0,t.bF)(Q,{label:"手机号"},{default:(0,t.k6)((function(){return[(0,t.bF)(O,{modelValue:j.editForm.phone,"onUpdate:modelValue":r[1]||(r[1]=function(e){return j.editForm.phone=e}),placeholder:"请输入手机号"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model"])]})),_:1},8,["modelValue"]),(0,t.bF)(H,{title:"修改密码",modelValue:j.passwordDialogVisible,"onUpdate:modelValue":r[8]||(r[8]=function(e){return j.passwordDialogVisible=e}),width:"500px"},{footer:(0,t.k6)((function(){return[(0,t.Lk)("span",T,[(0,t.bF)(M,{onClick:r[7]||(r[7]=function(e){return j.passwordDialogVisible=!1})},{default:(0,t.k6)((function(){return[(0,t.eW)("取消")]})),_:1}),(0,t.bF)(M,{type:"primary",onClick:J.updatePassword,loading:j.updatingPassword},{default:(0,t.k6)((function(){return[(0,t.eW)(" 保存 ")]})),_:1},8,["onClick","loading"])])]})),default:(0,t.k6)((function(){return[(0,t.bF)(G,{model:j.passwordForm,"label-width":"100px",rules:j.passwordRules,ref:"passwordFormRef"},{default:(0,t.k6)((function(){return[(0,t.bF)(Q,{label:"当前密码",prop:"currentPassword"},{default:(0,t.k6)((function(){return[(0,t.bF)(O,{modelValue:j.passwordForm.currentPassword,"onUpdate:modelValue":r[4]||(r[4]=function(e){return j.passwordForm.currentPassword=e}),type:"password","show-password":""},null,8,["modelValue"])]})),_:1}),(0,t.bF)(Q,{label:"新密码",prop:"newPassword"},{default:(0,t.k6)((function(){return[(0,t.bF)(O,{modelValue:j.passwordForm.newPassword,"onUpdate:modelValue":r[5]||(r[5]=function(e){return j.passwordForm.newPassword=e}),type:"password","show-password":""},null,8,["modelValue"])]})),_:1}),(0,t.bF)(Q,{label:"确认新密码",prop:"confirmPassword"},{default:(0,t.k6)((function(){return[(0,t.bF)(O,{modelValue:j.passwordForm.confirmPassword,"onUpdate:modelValue":r[6]||(r[6]=function(e){return j.passwordForm.confirmPassword=e}),type:"password","show-password":""},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])])}var J=a(14048),M=a(30388),O=a(41034),Q=(a(16280),a(76918),a(60739),a(23288),a(33110),a(26099),a(11392),a(76031),a(60782));const X={name:"Profile",data:function(){var e=this,r=function(r,a,t){""===a?t(new Error("请输入新密码")):(""!==e.passwordForm.confirmPassword&&e.$refs.passwordFormRef.validateField("confirmPassword"),t())},a=function(r,a,t){""===a?t(new Error("请再次输入密码")):a!==e.passwordForm.newPassword?t(new Error("两次输入密码不一致!")):t()};return{editDialogVisible:!1,passwordDialogVisible:!1,updating:!1,updatingPassword:!1,editForm:{username:"",avatar:null,avatarPreview:"",phone:""},passwordForm:{currentPassword:"",newPassword:"",confirmPassword:""},passwordRules:{currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"},{validator:r,trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:a,trigger:"blur"}]}}},computed:(0,O.A)((0,O.A)({},(0,Q.L8)({user:"auth/currentUser"})),{},{userAvatar:function(){return this.user&&this.user.avatar?this.user.avatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"}}),methods:{formatDate:function(e){if(!e)return"未知";var r=new Date(e);return r.toLocaleDateString("zh-CN")},showEditDialog:function(){this.user&&(this.editForm.username=this.user.username||"",this.editForm.phone=this.user.phone||"",this.editForm.avatarPreview="",this.editForm.avatar=null),this.editDialogVisible=!0},showPasswordDialog:function(){this.passwordForm.currentPassword="",this.passwordForm.newPassword="",this.passwordForm.confirmPassword="",this.passwordDialogVisible=!0},beforeAvatarUpload:function(e){var r=e.type.startsWith("image/"),a=e.size/1024/1024<2;return r?!!a||(this.$message.error("上传头像图片大小不能超过 2MB!"),!1):(this.$message.error("上传头像图片只能是图片格式!"),!1)},handleAvatarUpload:function(e){var r=this,a=e.file,t=new FileReader;t.onload=function(e){r.editForm.avatarPreview=e.target.result,r.editForm.avatar=a},t.readAsDataURL(a)},updateProfile:function(){var e=this;return(0,M.A)((0,J.A)().mark((function r(){var a,t,s,o;return(0,J.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,e.updating=!0,a={username:e.editForm.username,phone:e.editForm.phone||""},t=localStorage.getItem("token"),r.next=6,e.$axios.post("/api/user/update",a,{headers:{Authorization:"Bearer ".concat(t)}});case 6:s=r.sent,s.data&&200===s.data.code?(o=(0,O.A)((0,O.A)({},e.user),{},{username:e.editForm.username,phone:e.editForm.phone}),e.editForm.avatarPreview&&(o.avatar=e.editForm.avatarPreview),e.$store.commit("auth/SET_USER",o),localStorage.setItem("user",JSON.stringify(o)),e.$message.success("个人资料更新成功"),e.editDialogVisible=!1):e.$message.error(s.data.msg||"更新失败，请稍后重试"),r.next=14;break;case 10:r.prev=10,r.t0=r["catch"](0),console.error("更新个人资料失败:",r.t0),e.$message.error("更新失败: "+(r.t0.message||"服务器错误"));case 14:return r.prev=14,e.updating=!1,r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[0,10,14,17]])})))()},updatePassword:function(){var e=this;return(0,M.A)((0,J.A)().mark((function r(){return(0,J.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$refs.passwordFormRef.validate();case 3:return e.updatingPassword=!0,r.next=6,new Promise((function(e){return setTimeout(e,1e3)}));case 6:e.$message.success("密码修改成功"),e.passwordDialogVisible=!1,r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](0),r.t0&&r.t0.message&&e.$message.error("修改失败: "+r.t0.message);case 13:return r.prev=13,e.updatingPassword=!1,r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[0,10,13,16]])})))()}}};var G=a(71241);const H=(0,G.A)(X,[["render",j],["__scopeId","data-v-68369aa1"]]),K=H}}]);
//# sourceMappingURL=403.3a432a43.js.map