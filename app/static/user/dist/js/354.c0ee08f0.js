"use strict";(self["webpackChunkecodeco_user_client"]=self["webpackChunkecodeco_user_client"]||[]).push([[354],{87354:(e,t,u)=>{u.r(t),u.d(t,{default:()=>R});u(52675),u(89463),u(44114),u(62010),u(9868);var r=u(56768),a=u(95187),c=function(e){return(0,r.Qi)("data-v-f72c53d6"),e=e(),(0,r.jt)(),e},o={class:"product-detail"},n={key:0,class:"container"},l={class:"product-content"},i={class:"product-image"},d={class:"product-badges"},s={key:0,class:"eco-badge"},p={key:1,class:"recyclable-badge"},v={key:2,class:"custom-badge"},f={class:"product-info"},k={class:"product-name"},b={class:"product-meta"},g={class:"product-price"},m={class:"product-actions"},_=c((function(){return(0,r.Lk)("i",{class:"el-icon-shopping-cart-2"},null,-1)})),h={class:"product-tabs"},y={class:"product-description"},F=c((function(){return(0,r.Lk)("h3",null,"产品描述",-1)})),C=c((function(){return(0,r.Lk)("h3",null,"规格参数",-1)})),L={class:"related-products"},w=c((function(){return(0,r.Lk)("h2",{class:"section-title"},"相关产品推荐",-1)})),W={key:1,class:"loading-container"};function E(e,t,u,c,E,x){var A=(0,r.g2)("el-breadcrumb-item"),X=(0,r.g2)("el-breadcrumb"),P=(0,r.g2)("el-image"),I=(0,r.g2)("el-input-number"),V=(0,r.g2)("el-button"),T=(0,r.g2)("el-table-column"),q=(0,r.g2)("el-table"),K=(0,r.g2)("el-tab-pane"),Q=(0,r.g2)("el-tabs"),U=(0,r.g2)("product-card"),j=(0,r.g2)("el-col"),D=(0,r.g2)("el-row"),R=(0,r.g2)("el-skeleton"),N=(0,r.g2)("el-result");return(0,r.uX)(),(0,r.CE)("div",o,[c.product?((0,r.uX)(),(0,r.CE)("div",n,[(0,r.bF)(X,{separator:"/"},{default:(0,r.k6)((function(){return[(0,r.bF)(A,{to:{path:"/"}},{default:(0,r.k6)((function(){return[(0,r.eW)("首页")]})),_:1}),(0,r.bF)(A,{to:{path:"/products"}},{default:(0,r.k6)((function(){return[(0,r.eW)("全部产品")]})),_:1}),(0,r.bF)(A,{to:{path:"/products?category=".concat(c.product.category)}},{default:(0,r.k6)((function(){return[(0,r.eW)((0,a.v_)(c.product.category),1)]})),_:1},8,["to"]),(0,r.bF)(A,null,{default:(0,r.k6)((function(){return[(0,r.eW)((0,a.v_)(c.product.name),1)]})),_:1})]})),_:1}),(0,r.Lk)("div",l,[(0,r.Lk)("div",i,[(0,r.bF)(P,{src:c.fullImageUrl,alt:c.product.name,fit:"cover"},null,8,["src","alt"]),(0,r.Lk)("div",d,[c.product.eco_certification?((0,r.uX)(),(0,r.CE)("span",s,(0,a.v_)(c.product.eco_certification),1)):(0,r.Q3)("",!0),c.product.is_recyclable?((0,r.uX)(),(0,r.CE)("span",p,"可回收")):(0,r.Q3)("",!0),c.product.is_custom?((0,r.uX)(),(0,r.CE)("span",v,"可定制")):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",f,[(0,r.Lk)("h1",k,(0,a.v_)(c.product.name),1),(0,r.Lk)("div",b,[(0,r.Lk)("div",g,"¥"+(0,a.v_)(c.product.price.toFixed(2)),1),(0,r.Lk)("div",{class:(0,a.C4)(["product-stock",{"out-of-stock":c.product.stock<=0}])},(0,a.v_)(c.product.stock>0?"库存: ".concat(c.product.stock):"库存不足"),3)]),(0,r.Lk)("div",m,[(0,r.bF)(I,{modelValue:c.quantity,"onUpdate:modelValue":t[0]||(t[0]=function(e){return c.quantity=e}),min:1,max:c.product.stock,disabled:c.product.stock<=0},null,8,["modelValue","max","disabled"]),(0,r.bF)(V,{type:"primary",disabled:c.product.stock<=0,onClick:c.addToCart},{default:(0,r.k6)((function(){return[_,(0,r.eW)(" 加入购物车 ")]})),_:1},8,["disabled","onClick"]),(0,r.bF)(V,{type:"success",disabled:c.product.stock<=0,onClick:c.buyNow},{default:(0,r.k6)((function(){return[(0,r.eW)(" 立即购买 ")]})),_:1},8,["disabled","onClick"])])])]),(0,r.Lk)("div",h,[(0,r.bF)(Q,{modelValue:c.activeTab,"onUpdate:modelValue":t[1]||(t[1]=function(e){return c.activeTab=e})},{default:(0,r.k6)((function(){return[(0,r.bF)(K,{label:"产品详情",name:"details"},{default:(0,r.k6)((function(){return[(0,r.Lk)("div",y,[F,(0,r.Lk)("p",null,(0,a.v_)(c.product.description),1),C,(0,r.bF)(q,{data:c.specifications,stripe:"",style:{width:"100%"}},{default:(0,r.k6)((function(){return[(0,r.bF)(T,{prop:"name",label:"参数名",width:"180"}),(0,r.bF)(T,{prop:"value",label:"参数值"})]})),_:1},8,["data"])])]})),_:1})]})),_:1},8,["modelValue"])]),(0,r.Lk)("div",L,[w,(0,r.bF)(D,{gutter:20},{default:(0,r.k6)((function(){return[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.relatedProducts,(function(e){return(0,r.uX)(),(0,r.Wv)(j,{xs:24,sm:12,md:8,lg:6,key:e.id},{default:(0,r.k6)((function(){return[(0,r.bF)(U,{product:e},null,8,["product"])]})),_:2},1024)})),128))]})),_:1})])])):c.loading?((0,r.uX)(),(0,r.CE)("div",W,[(0,r.bF)(R,{rows:10,animated:""})])):((0,r.uX)(),(0,r.Wv)(N,{key:2,icon:"error",title:"加载失败","sub-title":"请稍后再试或返回首页"},{extra:(0,r.k6)((function(){return[(0,r.bF)(V,{type:"primary",onClick:t[2]||(t[2]=function(t){return e.$router.push("/")})},{default:(0,r.k6)((function(){return[(0,r.eW)("返回首页")]})),_:1})]})),_:1}))])}var x=u(14048),A=u(74721),X=u(30388),P=(u(28706),u(2008),u(74423),u(64346),u(48598),u(34782),u(18111),u(22489),u(26099),u(21699),u(71798)),I=u(50973),V=u(60782),T=u(51219),q=u(69204),K=u(61981),Q=u(41154);const U={name:"ProductDetail",components:{ProductCard:q.A,EcoIcon:Q.A},setup:function(){var e=(0,I.lq)(),t=(0,I.rd)(),a=(0,V.Pj)(),c=(0,r.EW)((function(){return a.getters["products/currentProduct"]})),o=(0,r.EW)((function(){return a.getters["isLoading"]})),n=(0,P.KR)("details"),l=(0,P.KR)(1),i=(0,r.EW)((function(){var e,t,u,r,a,o=[];if(null!==(e=c.value)&&void 0!==e&&e.material&&o.push({name:"种植基地",value:c.value.material}),void 0!==(null===(t=c.value)||void 0===t?void 0:t.eco_labels)&&null!==(null===(u=c.value)||void 0===u?void 0:u.eco_labels)&&c.value.eco_labels.length>0){var n=Array.isArray(c.value.eco_labels)?c.value.eco_labels.join("，"):c.value.eco_labels;o.push({name:"营养标签",value:n})}return void 0!==(null===(r=c.value)||void 0===r?void 0:r.carbon_footprint)&&null!==(null===(a=c.value)||void 0===a?void 0:a.carbon_footprint)&&o.push({name:"每件总量",value:"".concat(c.value.carbon_footprint," Kg")}),o.push({name:"产地",value:"中国大陆"}),o})),d=(0,P.KR)([]);(0,r.sV)((0,X.A)((0,x.A)().mark((function u(){var r,o,n,l;return(0,x.A)().wrap((function(u){while(1)switch(u.prev=u.next){case 0:if(u.prev=0,r=e.params.id,console.log("产品详情页-路由参数:",e.params),r){u.next=8;break}return console.error("产品ID为空，无法获取产品详情"),T.nk.error("无效的产品ID"),t.push("/products"),u.abrupt("return");case 8:return u.next=10,a.dispatch("products/fetchProduct",r);case 10:if(u.sent,c.value){u.next=16;break}return console.error("产品获取失败，返回产品列表页"),T.nk.error("无法获取产品详情"),t.push("/products"),u.abrupt("return");case 16:console.log("产品详情页-获取到产品:",c.value),o=a.getters["products/allProducts"],c.value&&o&&o.length>0?(n=c.value.product_id||c.value.id,d.value=o.filter((function(e){return e.category===c.value.category&&(e.product_id||e.id)!==n})).slice(0,4),d.value.length<4&&(l=o.filter((function(e){return(e.product_id||e.id)!==n&&!d.value.includes(e)})).slice(0,4-d.value.length),d.value=[].concat((0,A.A)(d.value),(0,A.A)(l)))):console.log("没有找到足够的产品数据来推荐相关产品"),u.next=25;break;case 21:u.prev=21,u.t0=u["catch"](0),console.error("获取产品详情失败:",u.t0),T.nk.error("获取产品详情失败");case 25:case"end":return u.stop()}}),u,null,[[0,21]])}))));var s=function(){c.value.stock<=0?T.nk.warning("该产品已售罄"):(a.dispatch("cart/addToCart",{product:c.value,quantity:l.value}),T.nk.success("成功添加到购物车"))},p=function(){s(),t.push("/cart")},v=(0,r.EW)((function(){return c.value?(console.log("处理产品图片，产品数据:",c.value),c.value.image?c.value.image:c.value.image_url?(0,K.m)(c.value.image_url):c.value.images&&c.value.images.length>0?c.value.images[0]:(console.warn("产品没有图片"),u(67015))):u(67015)}));return{product:c,loading:o,activeTab:n,quantity:l,specifications:i,relatedProducts:d,addToCart:s,buyNow:p,fullImageUrl:v}}};var j=u(71241);const D=(0,j.A)(U,[["render",E],["__scopeId","data-v-f72c53d6"]]),R=D}}]);
//# sourceMappingURL=354.c0ee08f0.js.map