import{a as h,r as z,y as q,c as H,b as g,d as t,w as a,e as s,E as f,u as J,z as K,o as U,g as i,B as L,p as B,G as O,t as v,v as Q}from"./index-gpBZUzsn.js";import{a as W}from"./index-t--hEgTQ.js";import{h as b}from"./http-D8_Qy496.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={login(d){return b.post("/api/auth/login",d)},getCurrentUser(){return b.get("/api/auth/me")},getUsers(d){return b.get("/api/users",{params:d})},getUser(d){return b.get(`/api/users/${d}`)},deleteUser(d){return b.delete(`/api/users/${d}`)}},Z={class:"users-container"},ee={class:"page-header"},te={class:"header-actions"},ae={class:"pagination-container"},le={class:"dialog-footer"},oe={__name:"Users",setup(d){J();const y=h(!1),V=h([]),w=h(!1),m=h({}),n=z({page:1,perPage:10,total:0}),r=z({username:"",email:""}),u=async()=>{y.value=!0;try{const l={page:n.page,per_page:n.perPage};r.username&&(l.username=r.username),r.email&&(l.email=r.email);const e=await W.get("/api/users",{params:l});e.data?(V.value=e.data.items,n.total=e.data.total):f.error("获取用户列表失败，请稍后重试")}catch(l){console.error("获取用户列表失败:",l),f.error("获取用户列表失败，请稍后重试")}finally{y.value=!1}},D=()=>{u()},P=()=>{n.page=1,u()},$=()=>{r.username="",r.email="",n.page=1,u()},S=l=>{n.perPage=l,u()},E=l=>{n.page=l,u()},N=l=>{m.value={...l},w.value=!0},I=l=>{Q.confirm(`确定要删除用户 "${l.username}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e=await Y.deleteUser(l.id);e&&e.code===200?(f.success("用户删除成功"),u()):f.error((e==null?void 0:e.msg)||"删除失败，请稍后重试")}catch(e){console.error("删除用户失败:",e),f.error("删除失败: "+(e.message||"未知错误"))}}).catch(()=>{})};return q(()=>{u()}),(l,e)=>{const c=s("el-button"),k=s("el-input"),C=s("el-form-item"),M=s("el-form"),x=s("el-card"),p=s("el-table-column"),T=s("el-table"),F=s("el-pagination"),_=s("el-descriptions-item"),j=s("el-descriptions"),A=s("el-dialog"),G=K("loading");return U(),H("div",Z,[g("div",ee,[e[7]||(e[7]=g("h1",{class:"page-title"},"用户管理",-1)),g("div",te,[t(c,{type:"primary",onClick:D},{default:a(()=>e[6]||(e[6]=[i("刷新数据")])),_:1})])]),t(x,{class:"filter-container",shadow:"never"},{default:a(()=>[t(M,{inline:!0,model:r,class:"filter-form"},{default:a(()=>[t(C,{label:"用户名"},{default:a(()=>[t(k,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=o=>r.username=o),placeholder:"输入用户名搜索"},null,8,["modelValue"])]),_:1}),t(C,{label:"邮箱"},{default:a(()=>[t(k,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=o=>r.email=o),placeholder:"输入邮箱搜索"},null,8,["modelValue"])]),_:1}),t(C,null,{default:a(()=>[t(c,{type:"primary",onClick:P},{default:a(()=>e[8]||(e[8]=[i("搜索")])),_:1}),t(c,{onClick:$},{default:a(()=>e[9]||(e[9]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(x,{class:"table-container",shadow:"never"},{default:a(()=>[L((U(),B(T,{data:V.value,style:{width:"100%"},border:""},{default:a(()=>[t(p,{type:"index",width:"50"}),t(p,{prop:"id",label:"用户ID",width:"100"}),t(p,{prop:"username",label:"用户名","min-width":"150"}),t(p,{prop:"email",label:"邮箱","min-width":"200"}),t(p,{prop:"phone",label:"手机号","min-width":"150"}),t(p,{prop:"created_at",label:"注册时间","min-width":"180"}),t(p,{label:"操作",width:"250"},{default:a(o=>[t(c,{size:"small",type:"primary",onClick:R=>N(o.row),link:""},{default:a(()=>e[10]||(e[10]=[i("查看")])),_:2},1032,["onClick"]),o.row.id!==1?(U(),B(c,{key:0,size:"small",type:"danger",onClick:R=>I(o.row),link:""},{default:a(()=>e[11]||(e[11]=[i("删除")])),_:2},1032,["onClick"])):O("",!0)]),_:1})]),_:1},8,["data"])),[[G,y.value]]),g("div",ae,[t(F,{"current-page":n.page,"onUpdate:currentPage":e[2]||(e[2]=o=>n.page=o),"page-size":n.perPage,"onUpdate:pageSize":e[3]||(e[3]=o=>n.perPage=o),total:n.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:S,onCurrentChange:E},null,8,["current-page","page-size","total"])])]),_:1}),t(A,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=o=>w.value=o),title:"用户详情",width:"30%"},{footer:a(()=>[g("span",le,[t(c,{onClick:e[4]||(e[4]=o=>w.value=!1)},{default:a(()=>e[12]||(e[12]=[i("关闭")])),_:1})])]),default:a(()=>[t(j,{column:1,border:""},{default:a(()=>[t(_,{label:"用户ID"},{default:a(()=>[i(v(m.value.id),1)]),_:1}),t(_,{label:"用户名"},{default:a(()=>[i(v(m.value.username),1)]),_:1}),t(_,{label:"邮箱"},{default:a(()=>[i(v(m.value.email),1)]),_:1}),t(_,{label:"手机号"},{default:a(()=>[i(v(m.value.phone||"未设置"),1)]),_:1}),t(_,{label:"注册时间"},{default:a(()=>[i(v(m.value.created_at),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},de=X(oe,[["__scopeId","data-v-fa85dd68"]]);export{de as default};
