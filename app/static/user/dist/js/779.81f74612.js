"use strict";(self["webpackChunkecodeco_user_client"]=self["webpackChunkecodeco_user_client"]||[]).push([[779],{69779:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});n(62010),n(9868);var o=n(56768),r=n(5688),a=n(95187),l=function(e){return(0,o.Qi)("data-v-0c065cc6"),e=e(),(0,o.jt)(),e},c={class:"product-list-page"},i={class:"container"},u={class:"page-header"},s=l((function(){return(0,o.Lk)("h1",null,"新鲜农产品",-1)})),d={class:"header-right"},g={class:"filter-section"},p={class:"filter-row"},f=l((function(){return(0,o.Lk)("div",{class:"filter-label"},"分类：",-1)})),v={class:"filter-options"},y={class:"filter-actions"},k={class:"sort-section"},h={class:"view-mode"},_={key:0,class:"products-loading"},b={class:"skeleton-item"},C={style:{padding:"14px"}},F={style:{"margin-top":"16px",display:"flex","justify-content":"space-between"}},m={key:1,class:"products-error"},w={key:2,class:"no-products"},L=["onClick"],P={class:"product-image"},W=l((function(){return(0,o.Lk)("div",{class:"image-error-slot"},[(0,o.Lk)("i",{class:"el-icon-picture-outline"}),(0,o.Lk)("p",null,"图片加载失败")],-1)})),E={key:0,class:"discount-badge"},x={class:"product-body"},K={class:"product-name"},X={class:"eco-badges"},q={class:"product-price"},R={class:"current-price"},V={key:0,class:"original-price"},z={class:"product-actions"},Q={key:4,class:"pagination-container"};function S(e,t,n,l,S,A){var I=(0,o.g2)("el-input"),M=(0,o.g2)("el-radio-button"),D=(0,o.g2)("el-radio-group"),U=(0,o.g2)("el-button"),j=(0,o.g2)("el-card"),B=(0,o.g2)("el-button-group"),T=(0,o.g2)("el-skeleton-item"),O=(0,o.g2)("el-skeleton"),$=(0,o.g2)("el-empty"),J=(0,o.g2)("el-image"),N=(0,o.g2)("el-tag"),G=(0,o.g2)("el-pagination");return(0,o.uX)(),(0,o.CE)("div",c,[(0,o.Lk)("div",i,[(0,o.Lk)("div",u,[s,(0,o.Lk)("div",d,[(0,o.bF)(I,{modelValue:l.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=function(e){return l.searchQuery=e}),placeholder:"搜索产品","prefix-icon":"el-icon-search",clearable:"",onClear:l.handleSearchClear,onKeyup:(0,r.jR)(l.handleSearch,["enter"]),class:"search-input"},null,8,["modelValue","onClear","onKeyup"])])]),(0,o.Lk)("div",g,[(0,o.bF)(j,null,{default:(0,o.k6)((function(){return[(0,o.Lk)("div",p,[f,(0,o.Lk)("div",v,[(0,o.bF)(D,{modelValue:l.filters.category,"onUpdate:modelValue":t[1]||(t[1]=function(e){return l.filters.category=e}),onChange:l.applyFilters},{default:(0,o.k6)((function(){return[(0,o.bF)(M,{label:""},{default:(0,o.k6)((function(){return[(0,o.eW)("全部")]})),_:1}),(0,o.bF)(M,{label:"蔬菜"},{default:(0,o.k6)((function(){return[(0,o.eW)("蔬菜")]})),_:1}),(0,o.bF)(M,{label:"水果"},{default:(0,o.k6)((function(){return[(0,o.eW)("水果")]})),_:1})]})),_:1},8,["modelValue","onChange"])])]),(0,o.Lk)("div",y,[(0,o.bF)(U,{type:"primary",onClick:l.applyFilters},{default:(0,o.k6)((function(){return[(0,o.eW)("应用筛选")]})),_:1},8,["onClick"]),(0,o.bF)(U,{onClick:l.resetFilters},{default:(0,o.k6)((function(){return[(0,o.eW)("重置")]})),_:1},8,["onClick"])])]})),_:1})]),(0,o.Lk)("div",k,[(0,o.bF)(D,{modelValue:l.sortBy,"onUpdate:modelValue":t[2]||(t[2]=function(e){return l.sortBy=e}),size:"small",onChange:l.handleSortChange},{default:(0,o.k6)((function(){return[(0,o.bF)(M,{label:"popularity"},{default:(0,o.k6)((function(){return[(0,o.eW)("热门")]})),_:1}),(0,o.bF)(M,{label:"newest"},{default:(0,o.k6)((function(){return[(0,o.eW)("最新")]})),_:1}),(0,o.bF)(M,{label:"price_asc"},{default:(0,o.k6)((function(){return[(0,o.eW)("价格从低到高")]})),_:1}),(0,o.bF)(M,{label:"price_desc"},{default:(0,o.k6)((function(){return[(0,o.eW)("价格从高到低")]})),_:1})]})),_:1},8,["modelValue","onChange"]),(0,o.Lk)("div",h,[(0,o.bF)(B,null,{default:(0,o.k6)((function(){return[(0,o.bF)(U,{type:"grid"===l.viewMode?"primary":"",icon:"el-icon-s-grid",onClick:t[3]||(t[3]=function(e){return l.viewMode="grid"})},null,8,["type"]),(0,o.bF)(U,{type:"list"===l.viewMode?"primary":"",icon:"el-icon-menu",onClick:t[4]||(t[4]=function(e){return l.viewMode="list"})},null,8,["type"])]})),_:1})])]),l.loading?((0,o.uX)(),(0,o.CE)("div",_,[(0,o.Lk)("div",{class:(0,a.C4)(["skeleton-container",{"list-view":"list"===l.viewMode}])},[(0,o.bF)(O,{count:8,animated:""},{template:(0,o.k6)((function(){return[(0,o.Lk)("div",b,[(0,o.bF)(T,{variant:"image",style:{width:"100%",height:"200px"}}),(0,o.Lk)("div",C,[(0,o.bF)(T,{variant:"h3",style:{width:"70%"}}),(0,o.Lk)("div",F,[(0,o.bF)(T,{variant:"text",style:{width:"30%"}}),(0,o.bF)(T,{variant:"text",style:{width:"30%"}})])])])]})),_:1})],2)])):l.error?((0,o.uX)(),(0,o.CE)("div",m,[(0,o.bF)($,{description:"加载产品失败"},{default:(0,o.k6)((function(){return[(0,o.bF)(U,{type:"primary",onClick:l.fetchProducts},{default:(0,o.k6)((function(){return[(0,o.eW)("重试")]})),_:1},8,["onClick"])]})),_:1})])):0===l.filteredProducts.length?((0,o.uX)(),(0,o.CE)("div",w,[(0,o.bF)($,{description:"没有找到匹配的产品"},{default:(0,o.k6)((function(){return[(0,o.bF)(U,{onClick:l.resetFilters},{default:(0,o.k6)((function(){return[(0,o.eW)("重置筛选条件")]})),_:1},8,["onClick"])]})),_:1})])):((0,o.uX)(),(0,o.CE)("div",{key:3,class:(0,a.C4)(["products-container",{"list-view":"list"===l.viewMode}])},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.filteredProducts,(function(t){return(0,o.uX)(),(0,o.CE)("div",{key:t.id,class:"product-card",onClick:function(e){return l.viewProductDetail(t)}},[(0,o.Lk)("div",P,[(0,o.bF)(J,{src:l.getFullImageUrl(t.image_url||t.image||t.product_image||""),alt:t.name,onError:function(){return e.console.warn("产品图片加载失败:",t.product_id||t.id)}},{error:(0,o.k6)((function(){return[W]})),_:2},1032,["src","alt","onError"]),t.discount?((0,o.uX)(),(0,o.CE)("div",E," -"+(0,a.v_)(t.discount)+"% ",1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",x,[(0,o.Lk)("h3",K,(0,a.v_)(t.name),1),(0,o.Lk)("div",X,[t.eco_certification?((0,o.uX)(),(0,o.Wv)(N,{key:0,size:"small",type:"success"},{default:(0,o.k6)((function(){return[(0,o.eW)((0,a.v_)(t.eco_certification),1)]})),_:2},1024)):(0,o.Q3)("",!0),t.is_recyclable?((0,o.uX)(),(0,o.Wv)(N,{key:1,size:"small",type:"info"},{default:(0,o.k6)((function(){return[(0,o.eW)(" 可回收 ")]})),_:1})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",q,[(0,o.Lk)("span",R,"¥"+(0,a.v_)(t.price.toFixed(2)),1),t.original_price?((0,o.uX)(),(0,o.CE)("span",V," ¥"+(0,a.v_)(t.original_price.toFixed(2)),1)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",z,[(0,o.bF)(U,{type:"primary",size:"small",icon:"el-icon-shopping-cart-2",onClick:(0,r.D$)((function(e){return l.addToCart(t)}),["stop"])},{default:(0,o.k6)((function(){return[(0,o.eW)(" 加入购物车 ")]})),_:2},1032,["onClick"]),(0,o.bF)(U,{size:"small",icon:"el-icon-view",onClick:(0,r.D$)((function(e){return l.viewProductDetail(t)}),["stop"])},{default:(0,o.k6)((function(){return[(0,o.eW)(" 查看详情 ")]})),_:2},1032,["onClick"])])])],8,L)})),128))],2)),l.totalPages>1?((0,o.uX)(),(0,o.CE)("div",Q,[(0,o.bF)(G,{background:"","current-page":l.currentPage,"page-size":l.pageSize,total:l.totalProducts,layout:"prev, pager, next",onCurrentChange:l.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])):(0,o.Q3)("",!0)])])}var A=n(14048),I=n(30388),M=n(74721),D=(n(52675),n(89463),n(28706),n(2008),n(74423),n(62062),n(44114),n(15086),n(26910),n(60739),n(23288),n(18111),n(22489),n(61701),n(13579),n(33110),n(26099),n(58940),n(27495),n(21699),n(25440),n(5746),n(71798)),U=n(50973),j=n(60782),B=n(51219),T=n(61981),O=n(50788),$=n.n(O);const J={name:"ProductList",setup:function(){var e=(0,U.rd)(),t=(0,U.lq)(),n=(0,j.Pj)(),r=(0,D.KR)([]),a=(0,D.KR)(!1),l=(0,D.KR)(!1),c=(0,D.KR)(1),i=(0,D.KR)(20),u=(0,D.KR)(0),s=(0,D.KR)(""),d=(0,D.KR)("grid"),g=(0,D.KR)("popularity"),p=(0,D.Kh)({category:"",ecoFeatures:[]}),f=(0,o.EW)((function(){return Math.ceil(u.value/i.value)})),v=(0,o.EW)((function(){console.log("开始筛选产品，原始数量:",r.value.length),r.value.length>0&&console.log("产品数据示例:",r.value[0]);var e=(0,M.A)(r.value);if(s.value){var t=s.value.toLowerCase();e=e.filter((function(e){return e.name&&e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)})),console.log("搜索筛选后数量:",e.length)}return p.category&&(console.log("应用分类筛选:",p.category),console.log("产品中的分类字段:",r.value.map((function(e){return"".concat(e.product_id,": ").concat(e.category||e.category_id)}))),e=e.filter((function(e){var t=e.category||e.category_id,n=t===p.category;return console.log("产品 ".concat(e.product_id," 分类 ").concat(t," 是否匹配 ").concat(p.category,": ").concat(n)),n})),console.log("分类筛选后数量:",e.length)),p.ecoFeatures.length>0&&(console.log("应用生态特性筛选:",p.ecoFeatures),e=e.filter((function(e){var t=p.ecoFeatures.some((function(t){return"recyclable"===t?e.is_recyclable:"organic"===t?"有机认证"===e.eco_certification:"energy_efficient"===t?"能源之星认证"===e.eco_certification:"low_voc"===t?"低VOC认证"===e.eco_certification:"sustainable_wood"===t&&"森林管理委员会认证"===e.eco_certification}));return t})),console.log("环保特性筛选后数量:",e.length)),"newest"===g.value?e.sort((function(e,t){return new Date(t.created_at||0)-new Date(e.created_at||0)})):"price_asc"===g.value?e.sort((function(e,t){return(e.price||0)-(t.price||0)})):"price_desc"===g.value?e.sort((function(e,t){return(t.price||0)-(e.price||0)})):"popularity"===g.value&&e.sort((function(e,t){return(t.sold_count||0)-(e.sold_count||0)})),console.log("最终显示产品数量:",e.length),e})),y=function(){console.log("初始化筛选条件，URL参数:",t.query),p.category="",p.ecoFeatures=[],s.value="",c.value=1,t.query.category&&(p.category=t.query.category),t.query.search&&(s.value=t.query.search),t.query.page&&(c.value=parseInt(t.query.page)||1),console.log("初始化后的筛选条件:",{category:p.category,ecoFeatures:p.ecoFeatures,searchQuery:s.value,page:c.value})},k=function(){var t={};p.category&&(t.category=p.category),s.value&&(t.search=s.value),c.value>1&&(t.page=c.value),e.replace({query:t})},h=function(){var e=(0,I.A)((0,A.A)().mark((function e(){var t,n,o,d;return(0,A.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.value=!0,l.value=!1,e.prev=2,t={page:c.value,size:i.value||20},console.log("获取产品列表，参数:",t),p.category&&(t.category_id=p.category,console.log("添加分类过滤:",p.category)),s.value&&(t.keyword=s.value,console.log("添加搜索关键词:",s.value)),g.value&&(t.sort=g.value,console.log("添加排序条件:",g.value)),console.log("完整请求参数:",t),e.next=11,$().get("/api/products/list",{params:t});case 11:n=e.sent,console.log("API响应状态:",n.status),console.log("API响应数据:",n.data),n.data&&200===n.data.code&&n.data.data&&n.data.data.list?(o=n.data.data.list,d=n.data.data.total||0,console.log("产品列表获取成功: ".concat(o.length,"个产品，总数:").concat(d)),o.length>0&&console.log("产品示例:",JSON.stringify(o[0])),r.value=o,u.value=d):(console.warn("API返回格式不符合预期:",n.data),r.value=[],u.value=0),e.next=23;break;case 17:e.prev=17,e.t0=e["catch"](2),console.error("获取产品列表失败:",e.t0),e.t0.response&&(console.error("错误状态码:",e.t0.response.status),console.error("错误数据:",e.t0.response.data)),l.value=!0,r.value=[];case 23:return e.prev=23,a.value=!1,e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[2,17,23,26]])})));return function(){return e.apply(this,arguments)}}(),_=function(e){c.value=e,h(),k(),window.scrollTo(0,0)},b=function(){console.log("应用筛选条件:",{category:p.category,ecoFeatures:p.ecoFeatures}),c.value=1,k(),h()},C=function(){console.log("重置所有筛选条件"),p.category="",p.ecoFeatures=[],c.value=1,s.value="",k(),h()},F=function(){console.log("执行搜索:",s.value),c.value=1,k(),h()},m=function(){console.log("清除搜索"),s.value="",F()},w=function(){},L=function(t){var n=t.product_id||t.id;e.push("/product/".concat(n))},P=function(e){n.dispatch("cart/addToCart",{product:e,quantity:1}),B.nk.success("已添加到购物车")};return(0,o.wB)((function(){return t.query}),(function(e){y()})),(0,o.sV)((function(){y(),h()})),{products:r,filteredProducts:v,loading:a,error:l,currentPage:c,pageSize:i,totalProducts:u,totalPages:f,searchQuery:s,viewMode:d,sortBy:g,filters:p,fetchProducts:h,handlePageChange:_,applyFilters:b,resetFilters:C,handleSearch:F,handleSearchClear:m,handleSortChange:w,viewProductDetail:L,addToCart:P,getFullImageUrl:T.m}}};var N=n(71241);const G=(0,N.A)(J,[["render",S],["__scopeId","data-v-0c065cc6"]]),H=G}}]);
//# sourceMappingURL=779.81f74612.js.map